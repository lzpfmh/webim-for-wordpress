(function(w,t,Y){function ga(){return(new Date).getTime()}function T(c){return v.call(c)==="[object Function]"}function V(c){return v.call(c)==="[object Array]"}function ha(c){return c&&v.call(c)==="[object Object]"}function W(c){return(c||"").replace(/^\s+|\s+$/g,"")}function D(c,e){var g=false;if(ha(e)){c=c||{};for(var i in e){var j=e[i];if(c[i]!=j){g=g||{};g[i]=j}}}return g}function E(c){var e=[];if(c!=null){var g=c.length;if(g==null||typeof c==="string"||T(c)||c.setInterval)e[0]=c;else for(;g;)e[--g]=
c[g]}return e}function z(){var c=arguments[0]||{},e=1,g=arguments.length,i=false,j;if(typeof c==="boolean"){i=c;c=arguments[1]||{};e=2}if(typeof c!=="object"&&!T(c))c={};for(;e<g;e++)if((j=arguments[e])!=null)for(var l in j){var r=c[l],s=j[l];if(c!==s)if(i&&s&&typeof s==="object"&&!s.nodeType)c[l]=z(i,r||(s.length!=null?[]:{}),s);else if(s!==Y)c[l]=s}return c}function H(c,e,g){var i,j=0,l=c.length,r=l===Y||T(c);if(g)if(r)for(i in c){if(e.apply(c[i],g)===false)break}else for(;j<l;){if(e.apply(c[j++],
g)===false)break}else if(r)for(i in c){if(e.call(c[i],i,c[i])===false)break}else for(g=c[0];j<l&&e.call(g,j,g)!==false;g=c[++j]);return c}function ia(c,e){for(var g=[],i,j=0,l=c.length;j<l;j++){i=e(c[j],j);if(i!=null)g[g.length]=i}return g.concat.apply([],g)}function M(c){var e=[];if(typeof c=="object"){for(var g in c)e[e.length]=encodeURIComponent(g)+"="+encodeURIComponent(c[g]);return e.join("&").replace(ja,"+")}return c}function x(c){c=z(true,c,z(true,{},Z,c));var e,g,i=c.context||w,j=c.type.toUpperCase();
if(c.data&&c.processData&&typeof c.data!=="string")c.data=M(c.data);if(c.cache===false&&j==="GET"){var l=ga(),r=c.url.replace(U,"$1_="+l+"$2");c.url=r+(r===c.url?(F.test(c.url)?"&":"?")+"_="+l:"")}if(c.data&&j==="GET")c.url+=(F.test(c.url)?"&":"?")+c.data;var s=false,p=c.xhr();c.username?p.open(j,c.url,c.async,c.username,c.password):p.open(j,c.url,c.async);try{c.data&&p.setRequestHeader("Content-Type",c.contentType);if(c.ifModified){$[c.url]&&p.setRequestHeader("If-Modified-Since",$[c.url]);ka[c.url]&&
p.setRequestHeader("If-None-Match",ka[c.url])}p.setRequestHeader("X-Requested-With","XMLHttpRequest");p.setRequestHeader("Accept",c.dataType&&c.accepts[c.dataType]?c.accepts[c.dataType]+", */*":c.accepts._default)}catch(Q){}if(c.beforeSend&&c.beforeSend.call(i,p,c)===false){p.abort();return false}var X=function(ba){if(!p||p.readyState===0){if(G){clearInterval(G);G=null}}else if(!s&&p&&(p.readyState===4||ba==="timeout")){s=true;if(G){clearInterval(G);G=null}var B;if(ba==="timeout")B="timeout";else{a:{try{B=
!p.status&&location.protocol==="file:"||p.status>=200&&p.status<300||p.status===304||p.status===1223||p.status===0;break a}catch(ca){}B=false}if(B){if(B=c.ifModified){B=p;var I=c.url,N=B.getResponseHeader("Last-Modified"),na=B.getResponseHeader("Etag");if(N)$[I]=N;if(na)ka[I]=na;B=B.status===304||B.status===0}B=B?"notmodified":"success"}else B="error";B=B}e=B;if(e==="success")try{B=p;var da=c.dataType;I=c;var oa=B.getResponseHeader("content-type"),a=da==="xml"||!da&&oa&&oa.indexOf("xml")>=0,b=a?B.responseXML:
B.responseText;if(a&&b.documentElement.nodeName==="parsererror")throw"parsererror";if(I&&I.dataFilter)b=I.dataFilter(b,da);if(typeof b==="string")if(da==="json")b=typeof O==="object"&&O.parse?O.parse(b):(new Function("return "+b))();g=b}catch(d){e="parsererror"}if(e==="success"||e==="notmodified")c.success&&c.success.call(i,g,e);else if(c.error)c.error.call(c.context||w,p,e,void 0);c.complete&&c.complete.call(i,p,e);ba&&p.abort();if(c.async)p=null}};if(c.async){var G=setInterval(X,13);c.timeout>0&&
setTimeout(function(){p&&!s&&X("timeout")},c.timeout)}try{p.send(j==="POST"||j==="PUT"?c.data:null)}catch(qa){if(c.error)c.error.call(c.context||w,p,null,qa)}c.async||X();return p}function la(){}function u(c){function e(){s=true;w[j]=Y;try{delete w[j]}catch(p){}r.onload=r.onreadystatechange=null;l&&r.parentNode&&l.removeChild(r)}c=z({},c);var g=""+M(c.data),i=c.context||w,j="jsonp"+ma++,l=t.getElementsByTagName("head")[0]||t.documentElement,r=t.createElement("script");g=(g?g+"&":"")+(c.jsonp||"callback")+
"="+j;c.url+=(F.test(c.url)?"&":"?")+g;r.src=c.url;if(c.scriptCharset)r.charset=c.scriptCharset;var s=false;w[j]=function(p){c.success&&c.success.call(i,p,"success");e()};r.onload=r.onreadystatechange=function(){if(!s&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c.error&&c.error.call(i,"error");e()}};c.timeout>0&&setTimeout(function(){if(!s){c.error&&c.error.call(i,"timeout");e();w[j]=la}},c.timeout);l.insertBefore(r,l.firstChild);return Y}function R(c,e){this._setting();
this.options={jsonp:false,server:null,ticket:null,domain:null,timeout:4E4,url:{send:null}};z(this.options,e)}function ea(c,e,g){if(typeof e!="undefined"){g=g||{};if(e===null){e="";g=z({},g);g.expires=-1}var i="";if(g.expires&&(typeof g.expires=="number"||g.expires.toUTCString)){if(typeof g.expires=="number"){i=new Date;i.setTime(i.getTime()+g.expires*24*60*60*1E3)}else i=g.expires;i="; expires="+i.toUTCString()}var j=g.path?"; path="+g.path:"",l=g.domain?"; domain="+g.domain:"";g=g.secure?"; secure":
"";t.cookie=[c,"=",encodeURIComponent(e),i,j,l,g].join("")}else{e=null;if(t.cookie&&t.cookie!=""){g=t.cookie.split(";");for(i=0;i<g.length;i++){j=W(g[i]);if(j.substring(0,c.length+1)==c+"="){e=decodeURIComponent(j.substring(c.length+1));break}}}return e}}function aa(c,e){if(fa){var g=new Date,i=["[",g.getHours(),":",g.getMinutes(),":",g.getSeconds(),"-",g.getMilliseconds(),"]"].join("");g=i+e+O.encode(c);w.console&&w.console.log(i,e,c);i=t.getElementById("webim-log")||t.body;w.air&&w.air.trace(g);
if(i){var j=t.createElement("P");j.innerHTML=g;i.appendChild(j)}}}function J(c,e){this.options=z({},J.defaults,e);this._init(c,e)}function pa(c){return c&&c.split?c.split(","):V(c)?c:parseInt(c)?[parseInt(c)]:[]}function K(c,e,g){function i(j,l){this.data=j;this.options=z({},i.defaults,l);T(this._init)&&this._init()}i.defaults=e;z(i.prototype,y,g);J[c]=i}var v=Object.prototype.toString,y={option:function(c,e){var g=c;this.options=this.options||{};if(typeof c=="string"){if(e===Y)return this.options[c];
g={};g[c]=e}z(this.options,g);return this},bind:function(c,e){var g=this._events=this._events||{};if(T(e)){g[c]=g[c]||[];g[c].push(e)}return this},trigger:function(c,e){var g=(this._events=this._events||{})[c];if(!g)return this;e=V(e)?e:E(e);for(var i=0,j=g.length;i<j;i++)g[i].apply(this,e);return this},unbind:function(c,e){var g=this._events=this._events||{};if(!g[c])return this;if(T(e)){g=g[c];for(var i=g.length;i--;)if(g[i]===e||g[i]===e._proxy)g.splice(i,1)}else delete g[c];return this},one:function(c,
e){if(!T(e))return this;var g=this,i=e._proxy=fun._proxy||function(){g.unbind(c,i);return e.apply(this,arguments)};g.bind(c,i)}},ma=ga(),F=/\?/,U=/(\?|&)_=.*?(&|$)/,ja=/%20/g,Z={url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return w.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",
text:"text/plain",_default:"*/*"}},$={},ka={},O=function(){function c(i){return g[i]||"\\u00"+Math.floor(i.charCodeAt()/16).toString(16)+(i.charCodeAt()%16).toString(16)}function e(i){switch(Object.prototype.toString.call(i)){case "[object String]":return'"'+i.replace(/[\x00-\x1f\\"]/g,c)+'"';case "[object Array]":for(var j=[],l=i.length,r=0;r<l;r++)j.push(e(i[r]));return"["+j.join(",")+"]";case "[object Object]":j=[];for(l in i)(r=e(i[l]))&&j.push(e(l)+":"+r);return"{"+j+"}";case "[object Number]":case "[object Boolean]":return String(i);
case false:return"null"}return null}var g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{encode:e,decode:function(i){i=i.toString();if(!i||!i.length)return null;return(new Function("return "+i))()}}}();z(R.prototype,y,{_setting:function(){this._onPolling=this._connecting=this.connected=false;this._pollTimer=null;this._failTimes=this._pollingTimes=0},connect:function(c){var e=this;z(e.options,c);if(e._connecting)return e;e._connecting=true;c=e.options;
e._onPolling||w.setTimeout(function(){e._startPolling()},300);return e},close:function(){this._pollTimer&&clearTimeout(this._pollTimer);this._setting();return this},_onConnect:function(){this.connected=true;this.trigger("connect","success")},_onClose:function(c){this._setting();this.trigger("close",[c])},_onData:function(c){this.trigger("data",c)},_onError:function(c){this._setting();this.trigger("error",c)},_startPolling:function(){var c=this.options;this._onPolling=true;this._pollingTimes++;var e=
{url:c.server,data:{domain:c.domain,ticket:c.ticket},dataType:"json",timeout:c.timeout,cache:false,context:this,success:this._onPollSuccess,error:this._onPollError};if(c.jsonp){z(e,{timeout:c.timeout,dataType:"jsonp",jsonp:"callback"});u(e)}else x(e)},_onPollSuccess:function(c){var e=this;e._onPolling=false;if(e._connecting)if(!c||!c.status)return e._onError("error data");else{e._pollingTimes==1&&e._onConnect();e._onData(c);e._failTimes=0;e._pollTimer=w.setTimeout(function(){e._startPolling()},200)}},
_onPollError:function(c){var e=this;e._onPolling=false;if(e._connecting){e._failTimes++;if(e._pollingTimes==1)e._onError("can not connect.");else if(e._failTimes>1)e._onClose(c);else e._pollTimer=w.setTimeout(function(){e._startPolling()},200)}}});var fa=true;aa.enable=function(){fa=true};aa.disable=function(){fa=false};z(J.prototype,y,{_init:function(){var c={presence:"offline",show:"unavailable"};this.data={user:c};this.status=new J.status;this.setting=new J.setting;this.buddy=new J.buddy(null,
{active:this.status.get("b")});this.room=new J.room(null,{user:c});this.history=new J.history(null,{user:c});this.connection=new R(null,{jsonp:true});this._initEvents()},user:function(c){z(this.data.user,c)},_ready:function(c){var e=this;e._unloadFun=w.onbeforeunload;w.onbeforeunload=function(){e._refresh()};e.trigger("ready",[c])},_go:function(){var c=this.data,e=this.history,g=this.buddy,i=this.room;e.option("userInfo",c.user);H(c.buddies,function(l,r){e.init("unicast",r.id,r.history)});g.handle(c.buddies);
H(c.rooms,function(l,r){e.init("multicast",r.id,r.history)});g=this.setting.get("blocked_rooms");var j=c.rooms;V(g)&&j&&H(g,function(l,r){j[r]&&(j[r].blocked=true)});i.handle(j);i.options.ticket=c.connection.ticket;this.trigger("go",[c]);this.connection.connect(c.connection);if((c=c.new_messages)&&c.length){H(c,function(l,r){r["new"]=true});this.trigger("message",[c])}},_stop:function(c){w.onbeforeunload=this._unloadFun;this.data.user.presence="offline";this.data.user.show="unavailable";this.buddy.clear();
this.trigger("stop",c)},autoOnline:function(){return!this.status.get("o")},_initEvents:function(){function c(j){var l={id:j.from,presence:j.type};if(j.show)l.show=j.show;if(j.nick)l.nick=j.nick;if(j.status)l.status=j.status;return l}var e=this,g=e.history,i=e.buddy;e.connection.bind("connect",function(){}).bind("data",function(j){e.handle(j)}).bind("error",function(){e._stop("connect error")}).bind("close",function(){e._stop("disconnect")});e.bind("message",function(j){for(var l=[],r=j.length,s=e.data.user.id,
p,Q,X,G=0;G<r;G++){p=j[G];X=p.type;Q=X=="unicast"?p.to==s?p.from:p.to:p.to;p.id=Q;if(X=="unicast"&&!p["new"]){Q={id:Q,presence:"online"};if(p.nick)Q.nick=p.nick;l.push(Q)}}if(l.length){i.presence(l);i.complete()}g.handle(j)});e.bind("presence",function(j){i.presence(ia(j,c))})},handle:function(c){c.messages&&c.messages.length&&this.trigger("message",[c.messages]);c.presences&&c.presences.length&&this.trigger("presence",[c.presences]);c.statuses&&c.statuses.length&&this.trigger("status",[c.statuses])},
sendMsg:function(c){c.ticket=this.data.connection.ticket;this.trigger("sendMsg",[c]);x({type:"post",url:this.options.urls.message,cache:false,data:c})},sendStatus:function(c){c.ticket=this.data.connection.ticket;x({type:"post",url:this.options.urls.status,cache:false,data:c})},sendPresence:function(c){c.ticket=this.data.connection.ticket;this.data.user.show=c.show;this.status.set("s",c.show);x({type:"post",url:this.options.urls.presence,cache:false,data:c})},online:function(c){var e=this,g=e.status,
i=[],j=[],l=g.get("tabs"),r=g.get("tabIds");r&&r.length&&l&&H(l,function(s){s[0]=="b"&&i.push(s.slice(2));s[0]=="r"&&j.push(s.slice(2))});c=z({buddy_ids:i.join(","),room_ids:j.join(","),show:g.get("s")||"available"},c);e._ready(c);g.set("o",false);g.set("s",c.show);x({type:"post",dataType:"json",data:c,url:e.options.urls.online,success:function(s){if(!s||!s.user||!s.connection)e._stop("online error");else{s.user=z(e.data.user,s.user,{presence:"online"});e.data=s;e._go()}},error:function(){e._stop("online error")}})},
offline:function(){var c=this.data;this.status.set("o",true);this.connection.close();this._stop("offline");x({type:"post",url:this.options.urls.offline,type:"post",cache:false,data:{status:"offline",ticket:c.connection.ticket}})},_refresh:function(){var c=this.data;!c||!c.connection||!c.connection.ticket||x({type:"post",url:this.options.urls.refresh,type:"post",cache:false,data:{ticket:c.connection.ticket}})}});w.webim=J;z(J,{version:"1.0.1",defaults:{urls:{online:"webim/online",offline:"webim/offline",
message:"webim/message",presence:"webim/presence",refresh:"webim/refresh",status:"webim/status"}},log:aa,idsArray:pa,now:ga,isFunction:T,isArray:V,isObject:ha,trim:W,makeArray:E,extend:z,each:H,inArray:function(c,e){for(var g=0,i=e.length;g<i;g++)if(e[g]===c)return g;return-1},grep:function(c,e,g){for(var i=[],j=0,l=c.length;j<l;j++)!g!==!e(c[j],j)&&i.push(c[j]);return i},map:ia,JSON:O,ajax:x,comet:R,model:K,objectExtend:y});K("setting",{url:"/webim/setting",data:{blocked_rooms:[],play_sound:true,
buddy_sticky:true,minimize_layout:true,msg_auto_pop:true}},{_init:function(){this.data=z({},this.options.data,this.data)},get:function(c){return this.data[c]},set:function(c,e){var g=this,i=c;if(c){if(typeof c=="string"){i={};i[c]=e}var j=g.data,l=D(j,i);if(l){H(l,function(r,s){g.trigger("update",[r,s])});i=z({},j,i);g.data=i;x({type:"post",url:g.options.url,dataType:"json",cache:false,data:{data:O.encode(i)}})}}}});K("status",{key:"_webim"},{_init:function(){var c=this.data;if(c)this._save(c);else this.data=
(c=ea(this.options.key))?O.decode(c):{}},set:function(c,e){var g=c;if(typeof c=="string"){g={};g[c]=e}var i=this.data;D(i,g)&&this._save(z({},i,g))},get:function(c){return this.data[c]},clear:function(){this._save({})},_save:function(c){this.data=c;ea(this.options.key,O.encode(c),{path:"/",domain:t.domain})}});K("buddy",{url:"/webim/buddy"},{_init:function(){this.data=this.data||[];this.dataHash={};this.handle(this.data)},clear:function(){this.data=[];this.dataHash={}},count:function(c){var e=this.dataHash,
g=0,i;for(var j in e)if(ha(c)){i=true;for(var l in c)if(c[l]!=e[j][l])i=false;i&&g++}else g++;return g},get:function(c){return this.dataHash[c]},complete:function(){var c=this.dataHash,e=[],g;for(var i in c){g=c[i];if(g.incomplete&&g.presence=="online"){g.incomplete=false;e.push(i)}}this.load(e)},update:function(c){this.load(c)},presence:function(c){var e=this.dataHash;c=V(c)?c:[c];for(var g in c){var i=c[g];i.presence=i.presence=="offline"?"offline":"online";i.incomplete=!e[i.id]}this.handle(c)},
load:function(c){c=pa(c);c.length&&x({type:"get",url:this.options.url,cache:false,dataType:"json",data:{ids:c.join(",")},context:this,success:this.handle})},handle:function(c){var e=this.data,g=this.dataHash,i={};c=c||[];var j,l;for(var r in c){j=c[r];if(id=j.id){if(!g[id]){j.presence=j.presence||"online";j.show=j.show?j.show:j.presence=="offline"?"unavailable":"available";g[id]={};e.push(g[id])}j.incomplete=!!j.incomplete;if(l=D(g[id],j)){j=l.presence||"update";i[j]=i[j]||[];z(g[id],l);i[j].push(g[id])}}}for(var s in i)this.trigger(s,
[i[s]]);this.options.active&&this.complete()}});(function(){K("room",{urls:{join:"/webim/join",leave:"/webim/leave",member:"/webim/members"}},{_init:function(){this.data=this.data||[];this.dataHash={}},get:function(c){return this.dataHash[c]},block:function(c){var e=this.dataHash[c];if(e&&!e.blocked){e.blocked=true;var g=[];H(this.dataHash,function(i,j){j.blocked&&g.push(j.id)});this.trigger("block",[c,g])}},unblock:function(c){var e=this.dataHash[c];if(e&&e.blocked){e.blocked=false;var g=[];H(this.dataHash,
function(i,j){j.blocked&&g.push(j.id)});this.trigger("unblock",[c,g])}},handle:function(c){var e=this,g=e.data,i=e.dataHash;H(c,function(j,l){var r=l.id;if(r){l.members=l.members||[];l.count=l.count||0;l.all_count=l.all_count||0;if(i[r])z(i[r],l);else{i[r]=l;g.push(l)}e.trigger("join",[i[r]])}})},addMember:function(c,e){var g=this;if(V(e))H(e,function(s,p){g.addMember(c,p)});else{var i=g.dataHash[c];if(i){for(var j=i.members,l,r=j.length;r--;)if(j[r].id==e.id)l=j[r];if(!l){e.nick=e.nick;j.push(e);
i.count=j.length;g.trigger("addMember",[c,e])}}}},removeMember:function(c,e){var g=this.dataHash[c];if(g){for(var i=g.members,j,l=i.length;l--;)if(i[l].id==e){j=i[l];i.splice(l,1);g.count--}j&&self.trigger("removeMember",[c,j])}},initMember:function(c){var e=this.dataHash[c];if(e&&!e.initMember){e.initMember=true;this.loadMember(c)}},loadMember:function(c){var e=this,g=e.options;x({type:"get",cache:false,url:g.urls.member,dataType:"json",data:{ticket:g.ticket,id:c},success:function(i){e.addMember(c,
i)}})},join:function(c){var e=this,g=e.options;x({cache:false,type:"post",url:g.urls.join,dataType:"json",data:{ticket:g.ticket,id:c,nick:g.user.nick},success:function(i){e.initMember(c);e.handle([i])}})},leave:function(c){var e=this.options,g=this.dataHash[c],i=e.user;if(g){g.initMember=false;x({cache:false,type:"post",url:e.urls.leave,data:{ticket:e.ticket,id:c,nick:i.nick}});this.trigger("leave",[g])}},clear:function(){}})})();K("history",{urls:{load:"webim/history",clear:"webim/clear_history"}},
{_init:function(){this.data=this.data||{};this.data.unicast=this.data.unicast||{};this.data.multicast=this.data.multicast||{}},unicast:function(c){return this.data.unicast[c]},multicast:function(c){return this.data.multicast[c]},handle:function(c){var e=this.data,g={unicast:{},multicast:{}};c=E(c);var i=c.length,j,l,r=this.options.userInfo.id;if(i){for(var s=0;s<i;s++){j=c[s];p=j.type;if((l=p=="unicast"?j.to==r?j.from:j.to:j.to)&&p){g[p][l]=g[p][l]||[];g[p][l].push(j)}}for(var p in g)for(l in g[p]){j=
g[p][l];if(e[p][l]){e[p][l]=e[p][l].concat(j);this._triggerMsg(p,l,j)}else this.load(p,l)}}},_triggerMsg:function(c,e,g){this.trigger(c,[e,g])},clear:function(c,e){var g=this.options;this.data[c][e]=[];this.trigger("clear",[c,e]);x({url:g.urls.clear,type:"post",cache:false,data:{type:c,id:e}})},init:function(c,e,g){if(V(g)){this.data[c][e]=g;this._triggerMsg(c,e,g)}},load:function(c,e){var g=this,i=g.options;g.data[c][e]=[];x({url:i.urls.load,cache:false,type:"get",dataType:"json",data:{type:c,id:e},
success:function(j){g.init(c,e,j)}})}})})(window,document);
(function(w,t,Y){function ga(){return false}function T(a){var b="";if(a.length==0)return"";b=a.replace(/&/g,"&gt;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/    /g,"&nbsp;");b=b.replace(/\'/g,"&#39;");b=b.replace(/\"/g,"&quot;");return b=b.replace(/\n/g,"<br />")}function V(a){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"])*$/.test(a)}function ha(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType==1&&a!=b&&d.push(a);return d}function W(a,b){return a&&
RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)}function D(a,b){if(a)W(a,b)||(a.className+=" "+b)}function E(a,b){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," "))}function z(a,b,d){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," ")+" "+d)}function H(a,b,d){u(a,"mouseover",function(){D(this,b);d&&E(this,d)});u(a,"mouseout",function(){E(this,b);d&&D(this,d)})}function ia(a,b,d){if(typeof d===
"boolean")d?D(a,b):E(a,b);else W(a,b)?E(a,b):D(a,b)}function M(a){a&&a.style&&(a.style.display="block")}function x(a){a&&a.style&&(a.style.display="none")}function la(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function u(a,b,d){if(a.addEventListener)a.addEventListener(b,d,false);else{a["e"+b+d]=d;a[b+d]=function(){return a["e"+b+d](w.event)};a.attachEvent("on"+b,a[b+d])}}function R(a){if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}}function ea(a){if(!a.target)a.target=a.srcElement||
t;if(a.target.nodeType===3)a.target=a.target.parentNode;return a.target}function aa(a){a.setAttribute("unselectable","on");a.style.MozUserSelect="none";u(a,"selectstart",ga)}function J(){if(!p){p=true;if(Q){for(var a,b=0;a=Q[b++];)a();Q=null}}}function pa(){if(!X){X=true;if(t.readyState==="complete")return J();if(t.addEventListener)t.addEventListener("DOMContentLoaded",function(){t.removeEventListener("DOMContentLoaded",arguments.callee,false);J()},false);else if(t.attachEvent){t.attachEvent("onreadystatechange",
function(){if(t.readyState==="complete"){t.detachEvent("onreadystatechange",arguments.callee);J()}});t.documentElement.doScroll&&w==w.top&&function(){if(!p){try{t.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}J()}}()}u(w,"load",J)}}function K(a){var b=new Date;b.setTime(a?parseFloat(a)+K.timeSkew:(new Date).getTime());this.date=b}function v(a,b,d){d=i({locale:v.locale},d);d=v.dictionary[d.locale];c(d)||(d={});a=d[a]===Y?a:d[a];if(b){ba=b;for(var f in b)a=a.replace(/\{\{(.*?)\}\}/g,
B)}return a}function y(a,b){this.element=a;this.options=i({},y.defaults,b);this._init()}function ma(a){a=a.getElementsByTagName("*");for(var b,d,f={},h=a.length-1;h>-1;h--){b=a[h];if((d=b.id)&&d.indexOf(":")==0)f[d.substring(1,d.length)]=b}return f}function F(a){var b=t.createElement("div");b.innerHTML=a;return b=b.firstChild}function U(a,b,d){function f(h,k){this.id=na++;this.name=a;this.className="webim-"+a;this.options=i({},f.defaults,k);if(this.element=h||this.template&&F(this.template())||this.options.template&&
F(I(this.options.template))){this.options.className&&D(this.element,this.options.className);this.$=ma(this.element)}O(this._init)&&this._init();O(this._initEvents)&&this._initEvents()}f.defaults=b;i(f.prototype,r,U.prototype,d);y[a]=f}function ja(a,b){y.apps[a]=b||{}}function Z(a,b){return b?a=="b"||a=="buddy"||a=="unicast"?"b_"+b:"r_"+b:a}function $(){t.selection&&(this.caretPos=t.selection.createRange())}var ka=webim.idsArray,O=webim.isFunction,fa=webim.isArray,c=webim.isObject,e=webim.trim,g=webim.makeArray,
i=webim.extend,j=webim.each,l=webim.grep,r=webim.objectExtend,s=webim.map,p=false,Q=[],X=false;K.timeSkew=0;K.init=function(a){K.timeSkew=(new Date).getTime()-parseFloat(a)};i(K.prototype,{getTime:function(){var a=this.date,b=a.getHours();a=a.getMinutes();if(a<10)a="0"+a;return b+":"+a+""},getDay:function(a){var b=this.date;if(a){a=new Date;a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);a=a.getTime()-b.getTime();if(a<=0)return v("dt:today");else if(a<864E5)return v("dt:yesterday")}return v("dt:monthdate",
{month:v(["dt:january","dt:february","dt:march","dt:april","dt:may","dt:june","dt:july","dt:august","dt:september","dt:october","dt:november","dt:december"][b.getMonth()]),date:b.getDate()})}});var G=function(){var a=true,b={lib:"sound.swf",msg:"sound/msg.mp3"};return{enable:function(){a=true},disable:function(){a=false},init:function(d){i(b,d);d=b.lib+"?_"+(new Date).getTime();d=navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length?'<embed type="application/x-shockwave-flash" width="10" height="10" id="webim-flashlib" allowscriptaccess="always" src="'+
d+'" />':'<object width="10" height="10" id="webim-flashlib" type="application/x-shockwave-flash" data="'+d+'">\t\t\t\t<param name="allowScriptAccess" value="always" />\t\t\t\t<param name="movie" value="'+d+'" />\t\t\t\t<param name="scale" value="noscale" />\t\t\t\t</object>';try{t.getElementById("webim-flashlib-c").innerHTML=d}catch(f){}},play:function(d){d=V(d)?d:b[d];if(a)try{t.getElementById("webim-flashlib").playSound(d?d:"/sound/sound.mp3")}catch(f){}}}}(),qa=function(){var a=false;u(w,"focus",
function(){a=false});u(w,"blur",function(){a=true});var b=t.title,d=0,f=false;return function(h,k){if(a){if(m){clearInterval(m);d=0;f=false}var m=setInterval(function(){d++;f=!f;if(d==k||!a){clearInterval(m);d=0;f=false}t.title=f?"["+h+"]"+b:b},1500)}}}(),ba={},B=function(a,b){return ba[b]||""};v.locale="zh-CN";v.dictionary={};v.store=function(a,b){var d=v.dictionary;c(d[a])||(d[a]={});i(d[a],b)};i(y.prototype,r,{render:function(){var a=this,b=a.layout;a.element.appendChild(b.element);setTimeout(function(){a.initSound()},
1E3);b.buildUI()},_init:function(){var a=this.im=new webim,b=this.options;b=this.layout=new y.layout(null,i({chatAutoPop:a.setting.get("msg_auto_pop")},b.layoutOptions));a.setting.get("play_sound")?G.enable():G.disable();a.setting.get("minimize_layout")?b.collapse():b.expand();this._initEvents()},addApp:function(a,b){var d=y.apps[a];if(d){var f=this,h=f.im;O(d.init)&&d.init.apply(f,[b]);O(d.ready)&&h.bind("ready",function(){d.ready.apply(f,arguments)});O(d.go)&&h.bind("go",function(){d.go.apply(f,
arguments)});O(d.stop)&&h.bind("stop",function(){d.stop.apply(f,arguments)})}},initSound:function(a){G.init(a||this.options.soundUrls)},_initEvents:function(){var a=this,b=a.im,d=b.buddy,f=b.history,h=b.setting,k=a.layout,m=b.room;b.bind("ready",function(){k.changeState("ready")}).bind("go",function(n){k.changeState("active");k.option("user",n.user);K.init(n.server_time);a._initStatus()}).bind("stop",function(n){n=="offline"&&k.removeAllChat();k.updateAllChat();k.changeState("stop")});h.bind("update",
function(n,q){switch(n){case "play_sound":q?G.enable():G.disable();break;case "msg_auto_pop":k.option("chatAutoPop",q);break;case "minimize_layout":q?k.collapse():k.expand();break}});d.bind("online",function(n){k.updateChat("buddy",n)}).bind("offline",function(n){k.updateChat("buddy",n)}).bind("update",function(n){k.updateChat("buddy",n)});m.bind("addMember",function(n,q){var o=k.chat("room",n);o&&o.addMember(q.id,q.nick,q.id==b.data.user.id)}).bind("removeMember",function(n,q){var o=k.chat("room",
n);o&&o.removeMember(q.id,q.nick)});k.bind("collapse",function(){h.set("minimize_layout",true)});k.bind("expand",function(){h.set("minimize_layout",false)});k.bind("displayUpdate",function(){a._updateStatus()});b.bind("message",function(n){for(var q=false,o=n.length,A,P=b.data.user.id,L,S,C=0;C<o;C++){A=n[C];L=A.id;type=A.type;(S=k.chat(type,L))&&S.status("");if(!S){A.type==="unicast"?a.addChat(type,L,null,null,A.nick):a.addChat(type,L);S=k.chat(type,L)}S&&h.get("msg_auto_pop")&&!k.activeTabId&&k.focusChat(L);
S.window.notifyUser("information","+1");L=S.window.pos;L==-1&&k.setNextMsgNum("+1");L==1&&k.setPrevMsgNum("+1");if(A.from!=P)q=true}if(q){G.play("msg");qa(v("new message"),5)}});b.bind("status",function(n){j(n,function(q,o){var A=b.data.user.id,P=o.from;if(!(A!=o.to&&A!=o.from))(A=k.chat("buddy",P))&&A.status(o.show)})});f.bind("unicast",function(n,q){var o=k.chat("unicast",n);o&&o.history.add(q)});f.bind("multicast",function(n,q){var o=k.chat("multicast",n);o&&o.history.add(q)});f.bind("clear",function(n,
q){var o=k.chat(n,q);o&&o.history.clear()})},__status:false,_initStatus:function(){var a=this,b=a.layout;if(a.__status)return b.updateAllChat();a.__status=true;var d=a.im.status,f=d.get("tabs"),h=d.get("tabIds"),k=d.get("p");d=d.get("a");h&&h.length&&f&&j(f,function(m,n){var q=m.slice(2),o=m.slice(0,1);a.addChat(o,q,{},{isMinimize:true});b.chat(m).window.notifyUser("information",n.n)});k&&(b.prevCount=k)&&b._fitUI();d&&b.focusChat(d)},addChat:function(a,b,d,f,h){a=a=="b"||a=="buddy"||a=="unicast"?
"buddy":"room";var k=this,m=k.layout,n=k.im,q=k.im.history,o=n.buddy,A=n.room;if(!m.chat(a,b))if(a=="room"){var P=q.multicast(b),L=A.get(b);h=L||{id:b,nick:h||b};h.presence="online";m.addChat(a,h,i({history:P,block:true,emot:true,clearHistory:false,member:true,msgType:"multicast"},d),f);P||q.load("multicast",b);var S=m.chat(a,b);S.bind("sendMsg",function(C){n.sendMsg(C);q.handle(C)}).bind("select",function(C){o.online(C.id);k.addChat("buddy",C.id,null,null,C.nick);m.focusChat("buddy",C.id)}).bind("block",
function(C){A.block(C.id)}).bind("unblock",function(C){A.unblock(C.id)}).window.bind("close",function(){S.options.info.blocked&&A.leave(b)});setTimeout(function(){S.options.info.blocked?A.join(b):A.initMember(b)},500);fa(h.members)&&j(h.members,function(C,ra){S.addMember(ra.id,ra.nick,ra.id==n.data.user.id)})}else{P=q.unicast(b);h=(L=o.get(b))||{id:b,nick:h||b};m.addChat(a,h,i({history:P,block:false,emot:true,clearHistory:true,member:false,msgType:"unicast"},d),f);L||o.update(b);P||q.load("unicast",
b);m.chat(a,b).bind("sendMsg",function(C){n.sendMsg(C);q.handle(C)}).bind("sendStatus",function(C){n.sendStatus(C)}).bind("clearHistory",function(C){q.clear("unicast",C.id)})}},_updateStatus:function(){var a=this.layout,b={};j(a.tabs,function(d,f){b[d]={n:f._count()}});this.im.status.set({tabs:b,tabIds:a.tabIds,p:a.prevCount,a:a.activeTabId})}});var ca=function(a,b){if(b===Y)return parseInt(a.innerHTML);else if(b){b=typeof b=="number"?b:parseInt(a.innerHTML)+parseInt(b);a.innerHTML=b.toString();M(a)}else{a.innerHTML=
"0";x(a)}return b},I=function(){function a(f,h){return b&&b[h]!=Y?b[h]:v(h)}var b=null,d=/\<\%\=(.*?)\%\>/ig;return function(f,h){if(!f)return"";b=h;return f.replace(d,a)}}(),N={add:function(a,b,d){a=y[a].prototype;for(var f in d){a.plugins[f]=a.plugins[f]||[];a.plugins[f].push([b,d[f]])}},call:function(a,b,d){if((b=a.plugins[b])&&a.element.parentNode)for(var f=0;f<b.length;f++)a.options[b[f][0]]&&b[f][1].apply(a.element,d)}},na=1;i(U.prototype,{_init:function(){}});i(y,{version:"3.0.1",widget:U,
app:ja,plugin:N,i18n:v,date:K,ready:function(a){pa();p?a():Q.push(a)},createElement:F,defaults:{},apps:{}});webim.ui=y;U("window",{isMinimize:false,minimizable:true,maximizable:false,closeable:true,sticky:true,titleVisibleLength:12,count:0,template:'<div id=":webim-window" class="webim-window ui-widget">                                            <div class="webim-window-tab-wrap">                                            <div id=":tab" class="webim-window-tab ui-state-default">                                            <div class="webim-window-tab-inner">                                                    <div id=":tabTip" class="webim-window-tab-tip">                                                            <strong id=":tabTipC"><%=tooltip%></strong>                                                    </div>                                                    <a id=":tabClose" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                    <div id=":tabCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em id=":tabIcon" class="webim-icon webim-icon-comments"></em>                                                    <h4 id=":tabTitle"><%=title%></h4>                                            </div>                                            </div>                                            </div>                                            <div><div id=":window" class="webim-window-window">\t\t\t\t\t\t<iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe>                                                    <div id=":header" class="webim-window-header ui-widget-header ui-corner-top">                                                            <span id=":actions" class="webim-window-actions">                                                                    <a id=":minimize" title="<%=minimize%>" class="webim-window-minimize" href="#minimize"><em class="ui-icon ui-icon-minus"><%=minimize%></em></a>                                                                    <a id=":maximize" title="<%=maximize%>" class="webim-window-maximize" href="#maximize"><em class="ui-icon ui-icon-plus"><%=maximize%></em></a>                                                                    <a id=":close" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                            </span>                                                            <h4 id=":headerTitle"><%=title%></h4>                                                            <div id=":subHeader" class="webim-window-subheader"></div>                                                    </div>                                                    <div id=":content" class="webim-window-content ui-widget-content">                                                    </div>                                            </div>                                            </div>                                            </div>'},
{html:function(a){return this.$.content.appendChild(a)},subHeader:function(a){this.$.subHeader.innerHTML="";return this.$.subHeader.appendChild(a)},_init:function(a,b){b=this.options;var d=this.$;a=this.element;a.window=this;b.tabWidth&&(d.tab.style.width=b.tabWidth+"px");b.subHeader&&this.subHeader(b.subHeader);this.title(b.title,b.icon);!b.minimizable&&x(d.minimize);!b.maximizable&&x(d.maximize);if(!b.closeable){x(d.tabClose);x(d.close)}b.isMinimize?this.minimize():this.restore();b.onlyIcon?x(d.tabTitle):
la(d.tabTip);b.count&&this.notifyUser("information",b.count);da(this)},notifyUser:function(a,b){var d=this.$;if(a=="information")if(this.isMinimize())if(ca(d.tabCount,b)){D(d.tab,"ui-state-highlight");E(d.tab,"ui-state-default")}},_count:function(){return ca(this.$.tabCount)},title:function(a,b){var d=this.$,f=d.tabIcon;if(b)if(V(b)){f.className="webim-icon";f.style.backgroundImage="url("+b+")"}else f.className="webim-icon webim-icon-"+b;d.tabTipC.innerHTML=a;f=this.options.titleVisibleLength;if(a){for(var h=
0,k=[],m=a.split(""),n=m.length,q=0;q<n;q++)if(h>=f||h<0)break;else{if(m[q].charCodeAt(0)>255)h+=2;else h++;k.push(m[q])}f=k.join("")}else f=a;(d.tabTitle.innerHTML=f)&&a&&f.length<a.length&&d.tabTitle.setAttribute("title",a);d.headerTitle.innerHTML=a},_changeState:function(a){z(this.element,"webim-window-normal webim-window-maximize webim-window-minimize","webim-window-"+(a=="restore"?"normal":a));this.trigger("displayStateChange",[a])},active:function(){return W(this.element,"webim-window-active")},
activate:function(){if(!this.active()){D(this.element,"webim-window-active");this.trigger("activate")}},deactivate:function(){if(this.active()){E(this.element,"webim-window-active");this.options.sticky||this.minimize();this.trigger("deactivate")}},_setVisibile:function(){var a=this.$;z(a.tab,"ui-state-default ui-state-highlight","ui-state-active");this.activate();ca(a.tabCount,0)},maximize:function(){if(!this.isMaximize()){this._setVisibile();this._changeState("maximize")}},restore:function(){if(!W(this.element,
"webim-window-normal")){this._setVisibile();this._changeState("restore")}},minimize:function(){if(!this.isMinimize()){z(this.$.tab,"ui-state-active","ui-state-default");this.deactivate();this._changeState("minimize")}},tabClose:function(){this.close()},close:function(){this.trigger("close");la(this.element)},_initEvents:function(){var a=this,b=a.$,d=b.tab,f=function(h){if(h){h.stopPropagation&&h.stopPropagation();h.cancelBubble=true}R(h)};u(d,"click",function(h){a.isMinimize()?a.restore():a.minimize();
f(h)});u(d,"mouseover",function(){D(this,"ui-state-hover");E(this,"ui-state-default")});u(d,"mouseout",function(){E(this,"ui-state-hover");this.className.indexOf("ui-state-")==-1&&D(this,"ui-state-default")});u(d,"mousedown",f);aa(d);j(ha(b.actions.firstChild),function(h,k){H(k,"ui-state-hover")});j(["minimize","maximize","close","tabClose"],function(h,k){u(b[k],"click",function(m){this.disabled||a[k]();f(m)});u(b[k],"mousedown",f)})},height:function(){return this.$.content.offsetHeight},_fitUI:function(){},
isMaximize:function(){return W(this.element,"webim-window-maximize")},isMinimize:function(){return W(this.element,"webim-window-minimize")}});var da=function(){var a=false,b=function(){a&&a.deactivate();a=false;return true},d=function(){this&&this!=a&&b()&&(a=this)},f=function(){this&&a==this&&(a=false)};u(t,"mousedown",function(h){h=ea(h);for(var k;h;)if(h.id==":webim-window"){k=h;break}else h=h.parentNode;if(k)(h=k.window)&&h.activate();else b()});return function(h){if(h.active()){b();a=h}h.bind("activate",
d);h.bind("deactivate",f)}}();U("layout",{template:'<div id="webim" class="webim webim-state-ready">                    <div class="webim-preload ui-helper-hidden-accessible">                    <div id="webim-flashlib-c">                    </div>                    </div><div id=":layout" class="webim-layout"><iframe class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><div class="webim-layout-bg ui-state-default ui-toolbar"></div><div class="webim-ui ui-helper-clearfix">                            <div id=":shortcut" class="webim-shortcut">                            </div>                            <div class="webim-layout-r">                            <div id=":panels" class="webim-panels">                                <div class="webim-window-tab-wrap ui-widget webim-panels-next-wrap">                                            <div id=":next" class="webim-window-tab webim-panels-next ui-state-default">                                                    <div id=":nextMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em class="ui-icon ui-icon-triangle-1-w"></em>                                                    <span id=":nextCount">0</span>                                            </div>                                </div>                                <div id=":tabsWrap" class="webim-panels-tab-wrap">                                        <div id=":tabs" class="webim-panels-tab">                                        </div>                                </div>                                <div class="webim-window-tab-wrap ui-widget webim-panels-prev-wrap">                                            <div id=":prev" class="webim-window-tab webim-panels-prev ui-state-default">                                                    <div id=":prevMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <span id=":prevCount">0</span>                                                    <em class="ui-icon ui-icon-triangle-1-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-collapse-wrap ui-widget">                                            <div id=":collapse" class="webim-window-tab webim-collapse ui-state-default" title="<%=collapse%>">                                                    <em class="ui-icon ui-icon-circle-arrow-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-expand-wrap ui-widget">                                            <div id=":expand" class="webim-window-tab webim-expand ui-state-default" title="<%=expand%>">                                                    <em class="ui-icon ui-icon-circle-arrow-w"></em>                                            </div>                                </div>                            </div>                            <div id=":widgets" class="webim-widgets">                            </div>                            </div>            </div></div>                    </div>',
shortcutLength:5,chatAutoPop:true,tpl_shortcut:'<div class="webim-window-tab-wrap ui-widget webim-shortcut-item"><a class="webim-window-tab" href="<%=link%>" target="<%=target%>">                                                    <div class="webim-window-tab-tip">                                                            <strong><%=title%></strong>                                                    </div>                                                    <em class="webim-icon" style="background-image:url(<%=icon%>)"></em>                                            </a>                                            </div>'},
{_init:function(a,b){b=this.options;i(this,{window:w,widgets:{},panels:{},tabWidth:136,maxVisibleTabs:null,animationTime:210,activeTabId:null,tabs:{},tabIds:[],nextCount:0,prevCount:0});b.unscalable&&D(this.$.layout,"webim-layout-unscalable");b.isMinimize&&this.collapse()},changeState:function(a){this.element.className="webim webim-state-"+a},_ready:false,buildUI:function(){var a=this.$;this.maxVisibleTabs=parseInt(((t.compatMode==="CSS1Compat"&&t.documentElement.clientWidth||t.body.clientWidth)-
45-a.shortcut.offsetWidth-a.widgets.offsetWidth-70)/this.tabWidth);this._fitUI();this._ready=true},_updatePrevCount:function(a){var b=this.tabIds,d=this.maxVisibleTabs,f=b.length,h=this.prevCount;if(!(f<=d)){if(a){for(var k=0,m=0;m<f;m++)if(b[m]==a){k=m;break}if(k<=h)h=k;else if(k>=h+d)h=k-d+1}else h=f-d;this.prevCount=h}},_setVisibleTabs:function(a){for(var b=this.prevCount,d=b+this.maxVisibleTabs,f=this.tabs,h=this.tabIds,k=h.length,m=0,n=0,q=0;q<k;q++){var o=f[h[q]];if(q<b||q>=d)if(a)M(o.element);
else{this.activeTabId==h[q]&&o.minimize();var A=o._count();if(q<b){n+=A;o.pos=1}else{m+=A;o.pos=-1}x(o.element)}else{o.pos=0;M(o.element)}}if(!a){this.setNextMsgNum(m);this.setPrevMsgNum(n)}},setNextMsgNum:function(a){ca(this.$.nextMsgCount,a)},setPrevMsgNum:function(a){ca(this.$.prevMsgCount,a)},slideing:false,_slide:function(a){var b=this,d=b.prevCount,f=b.nextCount;if(f>0&&a==-1||d>0&&a==1){b.slideing=true;if(f==1&&a==-1||d==1&&a==1)b.slideing=false;b._slideSetup(false);b._setVisibleTabs(true);
if(a==-1){b.nextCount--;b.prevCount++}else if(a==1){b.nextCount++;b.prevCount--}var h=b.$.tabs,k=parseFloat(h.style.left);d=-1*b.tabWidth*b.nextCount;var m=parseInt(500/13),n=1,q=(d-k)/m,o=setInterval(function(){h.style.left=k+q*n+"px";if(n==m){if(b.slideing)b._slide(a);else{b._fitUI();b._slideReset()}clearInterval(o)}else n++},13)}},_slideUp:function(){this.slideing=false},_slideSetup:function(a){var b=this.$,d=b.tabsWrap;b=b.tabs;if(!this._tabsWidth)this._tabsWidth=b.clientWidth;if(a)this._tabsWidth=
null;d.style.position=a?"":"relative";d.style.overflow=a?"visible":"hidden";d.style.width=a?"":this._tabsWidth+"px";b.style.width=a?"":this.tabWidth*this.tabIds.length+"px";b.style.position=a?"":"relative"},_slideReset:function(){this._slideSetup(true)},_updateCount:function(){var a=this.maxVisibleTabs,b=this.tabIds.length,d=this.prevCount,f=this.nextCount;if(b<=a)d=f=0;else{f=b-a-d;f=f<0?0:f;d=b-a-f}this.prevCount=d;this.nextCount=f},_updateCountUI:function(){var a=this.$,b=this.prevCount,d=this.nextCount;
d<=0?D(a.next,"ui-state-disabled"):E(a.next,"ui-state-disabled");b<=0?D(a.prev,"ui-state-disabled"):E(a.prev,"ui-state-disabled");if(b>0||d>0){a.next.style.display="block";a.prev.style.display="block"}else{x(a.next);x(a.prev)}a.nextCount.innerHTML=d.toString();a.prevCount.innerHTML=b.toString()},_initEvents:function(){var a=this,b=a.$,d=false;u(a.window,"resize",function(){if(d){d=true;a.buildUI()}});u(b.next,"mousedown",function(){a._slide(-1)});u(b.next,"mouseup",function(){a._slideUp()});aa(b.next);
u(b.prev,"mousedown",function(){a._slide(1)});u(b.prev,"mouseup",function(){a._slideUp()});aa(b.prev);u(b.expand,"click",function(){if(!a.isMinimize())return false;a.expand();a.trigger("expand");return false});u(b.collapse,"click",function(){if(a.isMinimize())return false;a.collapse();a.trigger("collapse");return false});H(b.collapse,"ui-state-hover","ui-state-default");H(b.expand,"ui-state-hover","ui-state-default")},isMinimize:function(){return W(this.$.layout,"webim-layout-minimize")},collapse:function(){this.isMinimize()||
D(this.$.layout,"webim-layout-minimize")},expand:function(){this.isMinimize()&&E(this.$.layout,"webim-layout-minimize")},_displayUpdate:function(){this._ready&&this.trigger("displayUpdate")},_fitUI:function(){this._updateCount();this.$.tabs.style.left=-1*this.tabWidth*this.nextCount+"px";this._updateCountUI();this._setVisibleTabs();this._displayUpdate()},_stickyWin:null,_widgetStateChange:function(a,b){b!="minimize"&&j(this.widgets,function(d,f){f.window!=a&&f.window.minimize()});this._displayUpdate()},
widget:function(a){return this.widgets[a]},addWidget:function(a,b,d,f){var h=this;b=i(b,{closeable:false,subHeader:a.header});var k=a.element;b=new y.window(null,b);b.html(k);h.$[f?f:"widgets"].insertBefore(b.element,d&&h.widgets[d]?h.widgets[d].window.element:null);a.window=b;b.bind("displayStateChange",function(m){h._widgetStateChange(this,m)});h.widgets[a.name]=a},focusChat:function(a,b){b=Z(a,b);var d=this.tabs[b],f=this.panels[b];d&&d.isMinimize()&&d.restore();f&&f.focus()},chat:function(a,b){return this.panels[Z(a,
b)]},updateChat:function(a,b){b=g(b);for(var d,f=b.length,h,k=0;k<f;k++){d=b[k];(h=this.panels[Z(a,d.id)])&&h.update(d)}},updateAllChat:function(){j(this.panels,function(a,b){b.update()})},_onChatClose:function(a){this.tabIds=l(this.tabIds,function(b){return b!=a});delete this.tabs[a];delete this.panels[a];this._changeActive(a,true);this._fitUI()},_onChatChange:function(a,b){if(b=="minimize"){this._changeActive(a,true);this._displayUpdate()}else{this._changeActive(a);this._fitUI()}},_changeActive:function(a,
b){var d=this.activeTabId;if(b)d==a&&(this.activeTabId=null);else{d&&d!=a&&this.tabs[d].minimize();this.activeTabId=a;this._updatePrevCount(a)}},addChat:function(a,b,d,f){var h=this,k=h.panels,m=b.id;m=Z(a,m);if(!k[m]){a=h.tabs[m]=(new y.window(null,i({isMinimize:h.activeTabId||!h.options.chatAutoPop,tabWidth:h.tabWidth-2,titleVisibleLength:9},f))).bind("close",function(){h._onChatClose(m)}).bind("displayStateChange",function(n){h._onChatChange(m,n)});h.tabIds.push(m);h.$.tabs.insertBefore(a.element,
h.$.tabs.firstChild);k[m]=new y.chat(null,i({window:a,user:h.options.user,info:b},d));!a.isMinimize()&&h._changeActive(m);h._fitUI()}},removeChat:function(a,b){var d=this.tabs[Z(a,b)];d&&d.close()},removeAllChat:function(){j(this.tabs,function(a,b){b.close()})},addShortcut:function(a){var b=this;if(fa(a))j(a,function(h,k){b.addShortcut(k)});else if(c(a)){var d=b.$.shortcut,f=b.options.tpl_shortcut;if(!(d.childNodes.length>b.options.shortcutLength+1)){f=F(I(f,{title:v(a.title),icon:a.icon,link:a.link,
target:a.isExtlink?"_blank":""}));H(f.firstChild,"ui-state-hover");d.appendChild(f)}}},addWindow:function(){new y.window(null,{})},online:function(){},offline:function(){}});U("history",{user:{},info:{},template:'<div class="webim-history">                        <div id=":content" class="webim-history-content">                 </div></div>'},{_init:function(){N.call(this,"init",[null,this.ui()])},clear:function(){this.$.content.innerHTML="";this.trigger("clear")},add:function(a){a=g(a);var b=a.length,
d=[];if(b){for(var f=0;f<b;f++)d.push(this._renderMsg(a[f]));this.$.content.innerHTML+=d.join("");this.trigger("update")}},_renderMsg:function(a){a=i({},a);N.call(this,"render",[null,this.ui({msg:a})]);var b=a.from,d=a.to,f=a.timestamp,h=a.body,k=true,m=this._lastLogItem,n=[],q;q=a.nick;if(m&&m.to==d&&m.from==b&&f-m.timestamp<6E4)k=false;if(k){this._lastLogItem=a;a=new K(f);n.push('<h4><span class="webim-gray">');n.push(a.getDay(true));n.push(" ");n.push(a.getTime());n.push("</span>");n.push(q);n.push('</h4><hr class="webim-line ui-state-default" />')}n.push("<p>");
n.push(h);n.push("</p>");return n.join("")},_renderDateBreak:function(a){var b=this._lastLogItem,d=new Date,f=new Date,h=[];d.setTime(a);b&&f.setTime(b.timestamp);if(!b||d.getDate()!=f.getDate()||d.getMonth()!=f.getMonth()){h.push("<h5>");h.push((new K(a)).getDay(true));h.push("</h5>")}return h.join("")},ui:function(a){return i({element:this.element,$:this.$},a)},plugins:{}});var oa=function(){function a(f,h){return'<a href="'+(h=="www."?"http://"+f:f)+'"'+d+">"+f+"</a>"}function b(f,h){d+=" "+f+
'="'+h+'"'}var d;return function(f,h){d="";h&&c(h)&&j(h,b);return f.replace(/(https?:\/\/|www\.)([^\s<]+)/ig,a)}}();y.history.defaults.parseMsg=true;N.add("history","parseMsg",{render:function(a,b){var d=b.msg.body;d=T(d);d=oa(d,{target:"_blank"});b.msg.body=d}});y.history.defaults.emot=true;N.add("history","emot",{render:function(a,b){b.msg.body=y.emot.parse(b.msg.body)}});U("emot",{template:'<div class="webim-emot ui-widget-content"><%=emots%></div>'},{_init:function(){var a=this,b=a.element;j(b.firstChild.childNodes,
function(d,f){u(f,"click",function(){E(b,"webim-emot-show");a.trigger("select",this.firstChild.getAttribute("alt"))})})},template:function(){var a=this.emots=webim.ui.emot.emots,b=[];b.push('<ul class="ui-helper-clearfix">');j(a,function(d,f){var h=f.src,k=f.t?f.t:f.q[0];b.push('<li><img src="');b.push(h);b.push('" title="');b.push(k);b.push('" alt="');b.push(f.q[0]);b.push('" /></li>')});b.push("</ul>");return I(this.options.template,{emots:b.join("")})},toggle:function(){ia(this.element,"webim-emot-show")}});
i(y.emot,{emots:[{t:"smile",src:"smile.png",q:[":)"]},{t:"smile_big",src:"smile-big.png",q:[":d",":-d",":D",":-D"]},{t:"sad",src:"sad.png",q:[":(",":-("]},{t:"wink",src:"wink.png",q:[";)",";-)"]},{t:"tongue",src:"tongue.png",q:[":p",":-p",":P",":-P"]},{t:"shock",src:"shock.png",q:["=-O","=-o"]},{t:"kiss",src:"kiss.png",q:[":-*"]},{t:"glasses_cool",src:"glasses-cool.png",q:["8-)"]},{t:"embarrassed",src:"embarrassed.png",q:[":-["]},{t:"crying",src:"crying.png",q:[":'("]},{t:"thinking",src:"thinking.png",
q:[":-/",":-\\"]},{t:"angel",src:"angel.png",q:["O:-)","o:-)"]},{t:"shut_mouth",src:"shut-mouth.png",q:[":-X",":-x"]},{t:"moneymouth",src:"moneymouth.png",q:[":-$"]},{t:"foot_in_mouth",src:"foot-in-mouth.png",q:[":-!"]},{t:"shout",src:"shout.png",q:[">:o",">:O"]}],init:function(a){var b=webim.ui.emot,d=b._q={};a=i({dir:"webim/static/emot/default"},a);if(a.emots)b.emots=a.emots;var f=a.dir+"/";j(b.emots,function(h,k){if(k&&k.src)k.src=f+k.src;k&&k.q&&j(k.q,function(m,n){d[n]=h})})},parse:function(a){var b=
webim.ui.emot._q,d=webim.ui.emot.emots;b&&j(b,function(f,h){var k=d[h],m=k.src,n=k.t?k.t:k.q[0],q=[];q.push('<img src="');q.push(m);q.push('" title="');q.push(n);q.push('" alt="');q.push(k.q[0]);q.push('" />');f=T(f);f=f.replace(RegExp("(\\"+".$^*\\[]()|+?{}:<>".split("").join("|\\")+")","g"),"\\$1");a=a.replace(RegExp(f,"g"),q.join(""))});return a}});U("chat",{tpl_header:'<div><div id=":user" class="webim-user"> \t\t\t<a id=":userPic" class="webim-user-pic ui-corner-all ui-state-active" href="#id"><img width="50" height="50" src="" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" class="ui-corner-all"></a> \t\t\t<span id=":userStatus" title="" class="webim-user-status">&nbsp;</span> \t\t     </div></div>',
template:'<div class="webim-chat"> \t\t\t\t<div class="webim-chat-notice-wrap"><div id=":notice" class="webim-chat-notice ui-state-highlight"></div></div>                                                 <div id=":content" class="webim-chat-content">                                                                                                                 <div id=":status" class="webim-chat-status webim-gray"></div>                                                 </div>                                                 <div id=":actions" class="webim-chat-actions">                                                         <div id=":toolContent" class="webim-chat-tool-content"></div>                                                        <div id=":tools" class="webim-chat-tools ui-helper-clearfix ui-state-default"></div>                                                        <table class="webim-chat-t" cellSpacing="0">                                                                 <tr>                                                                         <td style="vertical-align:top;">                                                                         <em class="webim-icon webim-icon-chat-edit"></em>                                                                        </td>                                                                         <td style="vertical-align:top;width:100%;">                                                                         <div class="webim-chat-input-wrap">                                                                                <textarea id=":input" class="webim-chat-input webim-gray ui-widget-content"><%=input notice%></textarea>                                                                         </div>                                                                         </td>                                                                 </tr>                                                         </table>                                                 </div>                                         </div>'},
{_init:function(){var a=this.element,b=this.options,d=this.window=b.window,f=this.history=new y.history(null,{user:b.user,info:b.info});this.$.content.insertBefore(f.element,this.$.content.firstChild);this.header=F(I(b.tpl_header));i(this.$,ma(this.header));if(d){d.subHeader(this.header);d.html(a);this._bindWindow()}this.update(b.info);f.add(b.history);N.call(this,"init",[null,this.ui()]);this._adjustContent()},update:function(a){if(a){this.option("info",a);this.history.option("info",a);this._updateInfo(a)}a=
this.options.info.presence=="online";if(this.options.user.presence=="online")a?this.notice(""):this.notice(v("buddy offline notice",{name:this.options.info.nick}));else this.notice(v("user offline notice"));N.call(this,"update",[null,this.ui()])},focus:function(){var a=this.$.input;w.setTimeout(function(){a.focus()},0)},_noticeTime:null,_noticeTxt:"",notice:function(a,b){var d=this,f=d.$.notice,h=d._noticeTime;h&&clearTimeout(h);if(a)if(b){f.innerHTML=a;M(f);setTimeout(function(){if(d._noticeTxt)f.innerHTML=
d._noticeTxt;else x(f,500)},b)}else{d._noticeTxt=a;f.innerHTML=a;M(f)}else{d._noticeTxt=null;x(f)}},_adjustContent:function(){var a=this.$.content;a.scrollTop=a.scrollHeight},_fitUI:function(){this._adjustContent()},_bindWindow:function(){var a=this;a.window.bind("displayStateChange",function(b){if(b!="minimize"){w.setTimeout(function(){a.$.input.focus()},0);a._adjustContent()}})},_inputAutoHeight:function(){var a=this.$.input,b=a[0].scrollTop;if(b>0){var d=a.height();d>32&&d<100&&a.height(d+b)}},
_sendMsg:function(a){var b=this.options,d=b.info;a={type:b.msgType,to:d.id,from:b.user.id,nick:b.user.nick,offline:d.presence!="online",timestamp:(new Date).getTime(),body:a};N.call(this,"send",[null,this.ui({msg:a})]);this.trigger("sendMsg",a)},_inputkeypress:function(a){if(a.keyCode==13)if(a.ctrlKey){this.insert("\n",true);return true}else{var b=ea(a),d=b.value;if(e(d)){this._sendMsg(d);b.value="";R(a)}}else this._typing()},_onFocusInput:function(a){var b=this;ea(a);(w.getSelection?w.getSelection().toString():
t.selection?t.selection.createRange().text:"")||w.setTimeout(function(){b.$.input.focus()},0)},_initEvents:function(){var a=this,b=a.$,d=v("input notice"),f=b.input;a.history.bind("update",function(){a._adjustContent()}).bind("clear",function(){a.notice(v("clear history notice"),3E3)});u(f,"keyup",function(){$.call(this)});u(f,"click",$);u(f,"select",$);u(f,"focus",function(){E(this,"webim-gray");if(this.value==d)this.value=""});u(f,"blur",function(){if(this.value==""){D(this,"webim-gray");this.value=
d}});u(f,"keypress",function(h){a._inputkeypress(h)});u(b.content,"click",function(h){a._onFocusInput(h)})},_updateInfo:function(a){var b=this.$;b.userPic.setAttribute("href",a.url);b.userPic.firstChild.setAttribute("defaultsrc",a.default_pic_url?a.default_pic_url:"");setTimeout(function(){if(a.pic_url||a.default_pic_url)b.userPic.firstChild.setAttribute("src",a.pic_url||a.default_pic_url)},100);b.userStatus.innerHTML=a.status||"&nbsp";this.window.title(a.nick,a.show)},insert:function(a,b){var d=
this.$.input;d.focus();if(b){a||(a="");if(d.setSelectionRange){var f=d.value,h=d.selectionStart,k=d.selectionEnd,m=f.substring(0,h);f=f.substring(k);k=a.length;d.value=m+a+f;d.setSelectionRange(h+k,h+k)}else if(t.selection)if(h=d.caretPos){h.text=a;h.collapse();h.select()}else d.value+=a;else d.value+=a}else d.value=a},_statusText:"",sendStatus:function(a){if(!(!a||a==this._statusText||this.options.info.presence=="offline")){this._statusText=a;this.trigger("sendStatus",{to:this.options.info.id,show:a})}},
_checkST:false,_typing:function(){var a=this;a.sendStatus("typing");a._checkST&&clearTimeout(a._checkST);a._checkST=w.setTimeout(function(){a.sendStatus("clear")},6E3)},_setST:null,status:function(a){a=a||"clear";var b=this.$.status,d=this.options.info.nick,f="";f=a=="clear"?"":d+v(a);b.innerHTML=f;this._adjustContent();this._setST&&clearTimeout(this._setST);if(f!="")this._setST=w.setTimeout(function(){b.innerHTML=""},1E4)},destroy:function(){this.window.close()},ui:function(a){return i({self:this,
$:this.$,history:this.history},a)},plugins:{}});y.chat.defaults.emot=true;N.add("chat","emot",{init:function(a,b){var d=b.self,f=new y.emot;f.bind("select",function(k){d.focus();d.insert(k,true)});var h=F(I('<a href="#chat-emot" title="<%=emot%>"><em class="webim-icon webim-icon-emot"></em></a>'));u(h,"click",function(k){R(k);f.toggle()});b.$.toolContent.appendChild(f.element);b.$.tools.appendChild(h)},send:function(){}});y.chat.defaults.clearHistory=true;N.add("chat","clearHistory",{init:function(a,
b){var d=b.self,f=F(I('<a href="#chat-clearHistory" title="<%=clear history%>"><em class="webim-icon webim-icon-clear"></em></a>'));u(f,"click",function(h){R(h);d.trigger("clearHistory",[d.options.info])});b.$.tools.appendChild(f)}});y.chat.defaults.block=true;N.add("chat","block",{init:function(a,b){var d=b.self,f=d.options.info.blocked,h=d.options.info.nick,k=F('<a href="#chat-block" style="display:'+(f?"none":"")+'" title="'+v("block group",{name:h})+'"><em class="webim-icon webim-icon-unblock"></em></a>'),
m=F('<a href="#chat-block" style="display:'+(f?"":"none")+'" title="'+v("unblock group",{name:h})+'"><em class="webim-icon webim-icon-block"></em></a>');u(k,"click",function(n){R(n);x(k);M(m);d.trigger("block",[d.options.info])});u(m,"click",function(n){R(n);x(m);M(k);d.trigger("unblock",[d.options.info])});b.$.tools.appendChild(k);b.$.tools.appendChild(m)}});y.chat.defaults.member=true;i(y.chat.prototype,{addMember:function(a,b,d){var f=this,h=f.memberLi;if(!h[a]){var k=F('<li><a class="'+(d?"ui-state-disabled":
"")+'" href="'+a+'">'+b+"</a></li>");u(k.firstChild,"click",function(m){R(m);d||f.trigger("select",[{id:a,nick:b}])});h[a]=k;f.$.member.appendChild(k);f.$.memberCount.innerHTML=parseInt(f.$.memberCount.innerHTML)+1}},removeMember:function(a){var b=this.memberLi[a];if(b){this.$.member.removeChild(b);delete this.memberLi[a];this.$.memberCount.innerHTML=parseInt(this.$.memberCount.innerHTML)-1}}});N.add("chat","member",{init:function(a,b){var d=b.$;b.self.memberLi={};var f=F(I('<div class="webim-member ui-widget-content ui-corner-left"><iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><h4><%=room member%>(<span id=":memberCount">0</span>)</h4><ul id=":ul"></ul></div>')),
h=ma(f);d.member=h.ul;d.memberCount=h.memberCount;d.content.parentNode.insertBefore(f,d.content)}});ja("buddy",{init:function(a){a=a||{};var b=this,d=b.im,f=d.buddy,h=b.layout,k=b.buddy=new y.buddy(null,i({title:v("buddy")},a));h.addWidget(k,i({title:v("buddy"),icon:"buddy",sticky:d.setting.get("buddy_sticky"),className:"webim-buddy-window",isMinimize:!d.status.get("b"),titleVisibleLength:19},a.windowOptions));if(!a.disable_user){b.addApp("user");k.window.subHeader(b.user.element)}d.setting.bind("update",
function(o,A){o=="buddy_sticky"&&k.window.option("sticky",A)});k.bind("select",function(o){b.addChat("buddy",o.id);b.layout.focusChat("buddy",o.id)}).bind("online",function(){d.online()});k.window.bind("displayStateChange",function(o){if(o!="minimize"){f.option("active",true);d.status.set("b",1);f.complete()}else{d.status.set("b",0);f.option("active",false)}});var m=function(o){return c(o)?o.id:o},n=function(o){return o.show!="invisible"&&o.presence=="online"},q=function(o){return o.show=="invisible"};
f.bind("online",function(o){k.add(l(o,n))});f.bind("offline",function(o){k.remove(s(o,m))});f.bind("update",function(o){k.add(l(o,n));k.update(l(o,n));k.remove(s(l(o,q),m))});k.offline()},ready:function(){this.buddy.online()},go:function(){this.buddy.titleCount()},stop:function(a){var b=this.buddy;b.offline();a&&b.notice(a)}});U("buddy",{template:'<div id="webim-buddy" class="webim-buddy">\t\t<div id=":search" class="webim-buddy-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>\t\t\t<div class="webim-buddy-content">\t\t\t\t<div id=":empty" class="webim-buddy-empty"><%=empty buddy%></div>\t\t\t\t\t<ul id=":ul"></ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>',
tpl_group:'<li><h4><%=title%>(<%=count%>)</h4><hr class="webim-line ui-state-default" /><ul></ul></li>',tpl_li:'<li title=""><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><em class="webim-icon webim-icon-<%=show%>" title="<%=human_show%>"><%=show%></em><img width="25" src="<%=pic_url%>" defaultsrc="<%=default_pic_url%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=nick%></strong><span><%=status%></span></a></li>'},{_init:function(){var a=
this.options;this.groups={};this.li={};this.li_group={};this.size=0;a.disable_group&&D(this.element,"webim-buddy-hidegroup")},_initEvents:function(){var a=this,b=a.$,d=b.search,f=b.searchInput,h=v("search buddy");u(d.firstChild,"click",function(){f.focus()});f.value=h;u(f,"focus",function(){D(d,"ui-state-active");if(this.value==h)this.value=""});u(f,"blur",function(){E(d,"ui-state-active");if(this.value=="")this.value=h});u(f,"keyup",function(){var k=this.value;j(a.li,function(m,n){k&&(n.text||n.innerHTML.replace(/<[^>]*>/g,
"")).indexOf(k)==-1?x(n):M(n)})})},titleCount:function(){var a=this.size,b=this.window,d=this.$.empty;b&&b.title(this.options.title+"("+(a?a:"0")+")");a?x(d):M(d);a>8?this.scroll(true):this.scroll(false)},scroll:function(a){ia(this.element,"webim-buddy-scroll",a)},_time:null,_titleBuddyOnline:function(a){var b=this;a||(a="");b._time&&clearTimeout(b._time);b._time=setTimeout(function(){b.titleCount()},5E3)},_title:function(a){var b=this.window;b&&b.title(this.options.title+"["+v(a)+"]")},notice:function(a,
b){switch(a){case "buddyOnline":this._titleBuddyOnline(b);break;default:this._title(a)}},online:function(){var a=this.$;this.notice("connect");M(a.empty)},offline:function(){var a=this.$;this.notice("offline");M(a.empty);this.scroll(false);this.removeAll()},_updateInfo:function(a,b){a=a.firstChild;a.setAttribute("href",b.url);a=a.firstChild;var d=b.show?b.show:"available";a.className="webim-icon webim-icon-"+d;a.setAttribute("title",v(d));a=a.nextSibling;a.setAttribute("defaultsrc",b.default_pic_url?
b.default_pic_url:"");if(b.pic_url||b.default_pic_url)a.setAttribute("src",b.pic_url||b.default_pic_url);a=a.nextSibling;a.innerHTML=b.nick;a=a.nextSibling;a.innerHTML=b.status||"&nbsp;";return a},_addOne:function(a,b){var d=this,f=d.li,h=a.id,k=d.$.ul;if(!f[h]){d.size++;if(!a.default_pic_url)a.default_pic_url="";a.status=a.status||"&nbsp;";a.show=a.show||"available";a.human_show=v(a.show);a.pic_url=a.pic_url||"";f=f[h]=F(I(d.options.tpl_li,a));u(f.firstChild,"click",function(q){R(q);d.trigger("select",
[a]);this.blur()});var m=d.groups,n=v(a.group||"friend");m=m[n];if(!m){m=F(I(d.options.tpl_group));x(m);if(n==v("stranger"))b=true;b?k.appendChild(m):k.insertBefore(m,k.firstChild);m={name:n,el:m,count:0,title:m.firstChild,li:m.lastChild};d.groups[n]=m}m.count==0&&M(m.el);d.li_group[h]=m;m.li.appendChild(f);m.count++;m.title.innerHTML=n+"("+m.count+")"}},_updateOne:function(a){var b=this.li,d=a.id;b[d]&&this._updateInfo(b[d],a)},update:function(a){a=g(a);for(var b=0;b<a.length;b++)this._updateOne(a[b])},
add:function(a,b){a=g(a);for(var d=0;d<a.length;d++)this._addOne(a[d],b);this.titleCount()},removeAll:function(){var a=[],b=this.li;for(var d in b)a.push(d);this.remove(a);this.titleCount()},remove:function(a){var b,d,f=this.li,h,k=this.li_group;a=ka(a);for(var m=0;m<a.length;m++){b=a[m];if(d=f[b]){this.size--;if(h=k[b]){h.count--;h.count==0&&x(h.el);h.title.innerHTML=h.name+"("+h.count+")"}la(d);delete f[b]}}this.titleCount()},select:function(a){(a=this.li[a])&&a.firstChild.click();return a},destroy:function(){}});
ja("visitorstatus",{init:function(){var a=this.im,b=a.status,d=b.get("v_f"),f=b.get("v_l"),h=t.referrer,k=t.location.href,m=t.location.host;if(h&&h!=d){var n=(ex=/\/\/([^\/]+)/.exec(h))&&ex[1];if(n&&n!=m)b.set("v_f",h);else h=d}else h=d;k!=f&&b.set("v_l",k);this.visitorstatus=k+(h?" | "+v("from")+" "+h:"");var q={};a.bind("sendMsg",function(o){var A="v_to_"+o.to;if(!q[A]){q[A]=true;var P="",L=a.status.get(A);if(!L||k!=f||h!=d){a.status.set(A,1);P=v("location")+": "+k;if(h&&(!L||h!=d))P+=" \n "+v("from")+
": "+h}P&&a.sendMsg(i({},o,{body:P}))}})},ready:function(a){a.visitorstatus=this.visitorstatus}})})(window,document);
