(function(v,u,W){function ga(){return(new Date).getTime()}function R(c){return w.call(c)==="[object Function]"}function T(c){return w.call(c)==="[object Array]"}function ha(c){return c&&w.call(c)==="[object Object]"}function U(c){return(c||"").replace(/^\s+|\s+$/g,"")}function D(c,e){var g=false;if(ha(e)){c=c||{};for(var h in e){var j=e[h];if(c[h]!=j){g=g||{};g[h]=j}}}return g}function E(c){var e=[];if(c!=null){var g=c.length;if(g==null||typeof c==="string"||R(c)||c.setInterval)e[0]=c;else for(;g;)e[--g]=
c[g]}return e}function z(){var c=arguments[0]||{},e=1,g=arguments.length,h=false,j;if(typeof c==="boolean"){h=c;c=arguments[1]||{};e=2}if(typeof c!=="object"&&!R(c))c={};for(;e<g;e++)if((j=arguments[e])!=null)for(var l in j){var r=c[l],s=j[l];if(c!==s)if(h&&s&&typeof s==="object"&&!s.nodeType)c[l]=z(h,r||(s.length!=null?[]:{}),s);else if(s!==W)c[l]=s}return c}function H(c,e,g){var h,j=0,l=c.length,r=l===W||R(c);if(g)if(r)for(h in c){if(e.apply(c[h],g)===false)break}else for(;j<l;){if(e.apply(c[j++],
g)===false)break}else if(r)for(h in c){if(e.call(c[h],h,c[h])===false)break}else for(g=c[0];j<l&&e.call(g,j,g)!==false;g=c[++j]);return c}function ia(c,e){for(var g=[],h,j=0,l=c.length;j<l;j++){h=e(c[j],j);if(h!=null)g[g.length]=h}return g.concat.apply([],g)}function L(c){var e=[];if(typeof c=="object"){for(var g in c)e[e.length]=encodeURIComponent(g)+"="+encodeURIComponent(c[g]);return e.join("&").replace(ma,"+")}return c}function x(c){c=z(true,c,z(true,{},Z,c));var e,g,h=c.context||v,j=c.type.toUpperCase();
if(c.data&&c.processData&&typeof c.data!=="string")c.data=L(c.data);if(c.cache===false&&j==="GET"){var l=ga(),r=c.url.replace(S,"$1_="+l+"$2");c.url=r+(r===c.url?(F.test(c.url)?"&":"?")+"_="+l:"")}if(c.data&&j==="GET")c.url+=(F.test(c.url)?"&":"?")+c.data;var s=false,o=c.xhr();c.username?o.open(j,c.url,c.async,c.username,c.password):o.open(j,c.url,c.async);try{c.data&&o.setRequestHeader("Content-Type",c.contentType);if(c.ifModified){$[c.url]&&o.setRequestHeader("If-Modified-Since",$[c.url]);ja[c.url]&&
o.setRequestHeader("If-None-Match",ja[c.url])}o.setRequestHeader("X-Requested-With","XMLHttpRequest");o.setRequestHeader("Accept",c.dataType&&c.accepts[c.dataType]?c.accepts[c.dataType]+", */*":c.accepts._default)}catch(X){}if(c.beforeSend&&c.beforeSend.call(h,o,c)===false){o.abort();return false}var V=function(ba){if(!o||o.readyState===0){if(G){clearInterval(G);G=null}}else if(!s&&o&&(o.readyState===4||ba==="timeout")){s=true;if(G){clearInterval(G);G=null}var A;if(ba==="timeout")A="timeout";else{a:{try{A=
!o.status&&location.protocol==="file:"||o.status>=200&&o.status<300||o.status===304||o.status===1223||o.status===0;break a}catch(ca){}A=false}if(A){if(A=c.ifModified){A=o;var I=c.url,M=A.getResponseHeader("Last-Modified"),na=A.getResponseHeader("Etag");if(M)$[I]=M;if(na)ja[I]=na;A=A.status===304||A.status===0}A=A?"notmodified":"success"}else A="error";A=A}e=A;if(e==="success")try{A=o;var da=c.dataType;I=c;var oa=A.getResponseHeader("content-type"),a=da==="xml"||!da&&oa&&oa.indexOf("xml")>=0,b=a?A.responseXML:
A.responseText;if(a&&b.documentElement.nodeName==="parsererror")throw"parsererror";if(I&&I.dataFilter)b=I.dataFilter(b,da);if(typeof b==="string")if(da==="json")b=typeof N==="object"&&N.parse?N.parse(b):(new Function("return "+b))();g=b}catch(d){e="parsererror"}if(e==="success"||e==="notmodified")c.success&&c.success.call(h,g,e);else if(c.error)c.error.call(c.context||v,o,e,void 0);c.complete&&c.complete.call(h,o,e);ba&&o.abort();if(c.async)o=null}};if(c.async){var G=setInterval(V,13);c.timeout>0&&
setTimeout(function(){o&&!s&&V("timeout")},c.timeout)}try{o.send(j==="POST"||j==="PUT"?c.data:null)}catch(qa){if(c.error)c.error.call(c.context||v,o,null,qa)}c.async||V();return o}function ka(){}function t(c){function e(){s=true;v[j]=W;try{delete v[j]}catch(o){}r.onload=r.onreadystatechange=null;l&&r.parentNode&&l.removeChild(r)}c=z({},c);var g=""+L(c.data),h=c.context||v,j="jsonp"+la++,l=u.getElementsByTagName("head")[0]||u.documentElement,r=u.createElement("script");g=(g?g+"&":"")+(c.jsonp||"callback")+
"="+j;c.url+=(F.test(c.url)?"&":"?")+g;r.src=c.url;if(c.scriptCharset)r.charset=c.scriptCharset;var s=false;v[j]=function(o){c.success&&c.success.call(h,o,"success");e()};r.onload=r.onreadystatechange=function(){if(!s&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){c.error&&c.error.call(h,"error");e()}};c.timeout>0&&setTimeout(function(){if(!s){c.error&&c.error.call(h,"timeout");e();v[j]=ka}},c.timeout);l.insertBefore(r,l.firstChild);return W}function P(c,e){this._setting();
this.options={jsonp:false,server:null,ticket:null,domain:null,timeout:4E4,url:{send:null}};z(this.options,e)}function ea(c,e,g){if(typeof e!="undefined"){g=g||{};if(e===null){e="";g=z({},g);g.expires=-1}var h="";if(g.expires&&(typeof g.expires=="number"||g.expires.toUTCString)){if(typeof g.expires=="number"){h=new Date;h.setTime(h.getTime()+g.expires*24*60*60*1E3)}else h=g.expires;h="; expires="+h.toUTCString()}var j=g.path?"; path="+g.path:"",l=g.domain?"; domain="+g.domain:"";g=g.secure?"; secure":
"";u.cookie=[c,"=",encodeURIComponent(e),h,j,l,g].join("")}else{e=null;if(u.cookie&&u.cookie!=""){g=u.cookie.split(";");for(h=0;h<g.length;h++){j=U(g[h]);if(j.substring(0,c.length+1)==c+"="){e=decodeURIComponent(j.substring(c.length+1));break}}}return e}}function aa(c,e){if(fa){var g=new Date,h=["[",g.getHours(),":",g.getMinutes(),":",g.getSeconds(),"-",g.getMilliseconds(),"]"].join("");g=h+e+N.encode(c);v.console&&v.console.log(h,e,c);h=u.getElementById("webim-log")||u.body;v.air&&v.air.trace(g);
if(h){var j=u.createElement("P");j.innerHTML=g;h.appendChild(j)}}}function J(c,e){this.options=z({},J.defaults,e);this._init(c,e)}function pa(c){return c&&c.split?c.split(","):T(c)?c:parseInt(c)?[parseInt(c)]:[]}function K(c,e,g){function h(j,l){this.data=j;this.options=z({},h.defaults,l);R(this._init)&&this._init()}h.defaults=e;z(h.prototype,y,g);J[c]=h}var w=Object.prototype.toString,y={option:function(c,e){var g=c;this.options=this.options||{};if(typeof c=="string"){if(e===W)return this.options[c];
g={};g[c]=e}z(this.options,g);return this},bind:function(c,e){var g=this._events=this._events||{};if(R(e)){g[c]=g[c]||[];g[c].push(e)}return this},trigger:function(c,e){var g=(this._events=this._events||{})[c];if(!g)return this;e=T(e)?e:E(e);for(var h=0,j=g.length;h<j;h++)g[h].apply(this,e);return this},unbind:function(c,e){var g=this._events=this._events||{};if(!g[c])return this;if(R(e)){g=g[c];for(var h=g.length;h--;)if(g[h]===e||g[h]===e._proxy)g.splice(h,1)}else delete g[c];return this},one:function(c,
e){if(!R(e))return this;var g=this,h=e._proxy=fun._proxy||function(){g.unbind(c,h);return e.apply(this,arguments)};g.bind(c,h)}},la=ga(),F=/\?/,S=/(\?|&)_=.*?(&|$)/,ma=/%20/g,Z={url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return v.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",
text:"text/plain",_default:"*/*"}},$={},ja={},N=function(){function c(h){return g[h]||"\\u00"+Math.floor(h.charCodeAt()/16).toString(16)+(h.charCodeAt()%16).toString(16)}function e(h){switch(Object.prototype.toString.call(h)){case "[object String]":return'"'+h.replace(/[\x00-\x1f\\"]/g,c)+'"';case "[object Array]":for(var j=[],l=h.length,r=0;r<l;r++)j.push(e(h[r]));return"["+j.join(",")+"]";case "[object Object]":j=[];for(l in h)(r=e(h[l]))&&j.push(e(l)+":"+r);return"{"+j+"}";case "[object Number]":case "[object Boolean]":return String(h);
case false:return"null"}return null}var g={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{encode:e,decode:function(h){h=h.toString();if(!h||!h.length)return null;return(new Function("return "+h))()}}}();z(P.prototype,y,{_setting:function(){this._onPolling=this._connecting=this.connected=false;this._pollTimer=null;this._failTimes=this._pollingTimes=0},connect:function(c){var e=this;z(e.options,c);if(e._connecting)return e;e._connecting=true;c=e.options;
e._onPolling||v.setTimeout(function(){e._startPolling()},300);return e},close:function(){this._pollTimer&&clearTimeout(this._pollTimer);this._setting();return this},_onConnect:function(){this.connected=true;this.trigger("connect","success")},_onClose:function(c){this._setting();this.trigger("close",[c])},_onData:function(c){this.trigger("data",c)},_onError:function(c){this._setting();this.trigger("error",c)},_startPolling:function(){var c=this.options;this._onPolling=true;this._pollingTimes++;var e=
{url:c.server,data:{domain:c.domain,ticket:c.ticket},dataType:"json",timeout:c.timeout,cache:false,context:this,success:this._onPollSuccess,error:this._onPollError};if(c.jsonp){z(e,{timeout:c.timeout,dataType:"jsonp",jsonp:"callback"});t(e)}else x(e)},_onPollSuccess:function(c){var e=this;e._onPolling=false;if(e._connecting)if(!c||!c.status)return e._onError("error data");else{e._pollingTimes==1&&e._onConnect();e._onData(c);e._failTimes=0;e._pollTimer=v.setTimeout(function(){e._startPolling()},200)}},
_onPollError:function(c){var e=this;e._onPolling=false;if(e._connecting){e._failTimes++;if(e._pollingTimes==1)e._onError("can not connect.");else if(e._failTimes>1)e._onClose(c);else e._pollTimer=v.setTimeout(function(){e._startPolling()},200)}}});var fa=true;aa.enable=function(){fa=true};aa.disable=function(){fa=false};z(J.prototype,y,{_init:function(){var c={presence:"offline",show:"unavailable"};this.data={user:c};this.status=new J.status;this.setting=new J.setting;this.buddy=new J.buddy(null,
{active:this.status.get("b")});this.room=new J.room(null,{user:c});this.history=new J.history(null,{user:c});this.connection=new P(null,{jsonp:true});this._initEvents()},user:function(c){z(this.data.user,c)},_ready:function(c){var e=this;e._unloadFun=v.onbeforeunload;v.onbeforeunload=function(){e._refresh()};e.trigger("ready",[c])},_go:function(){var c=this.data,e=this.history,g=this.buddy,h=this.room;e.option("userInfo",c.user);H(c.buddies,function(l,r){e.init("unicast",r.id,r.history)});g.handle(c.buddies);
H(c.rooms,function(l,r){e.init("multicast",r.id,r.history)});g=this.setting.get("blocked_rooms");var j=c.rooms;T(g)&&j&&H(g,function(l,r){j[r]&&(j[r].blocked=true)});h.handle(j);h.options.ticket=c.connection.ticket;this.trigger("go",[c]);this.connection.connect(c.connection);if((c=c.new_messages)&&c.length){H(c,function(l,r){r["new"]=true});this.trigger("message",[c])}},_stop:function(c){v.onbeforeunload=this._unloadFun;this.data.user.presence="offline";this.data.user.show="unavailable";this.buddy.clear();
this.trigger("stop",c)},autoOnline:function(){return!this.status.get("o")},_initEvents:function(){function c(j){var l={id:j.from,presence:j.type};if(j.show)l.show=j.show;if(j.nick)l.nick=j.nick;return l}var e=this,g=e.history,h=e.buddy;e.connection.bind("connect",function(){}).bind("data",function(j){e.handle(j)}).bind("error",function(){e._stop("connect error")}).bind("close",function(){e._stop("disconnect")});e.bind("message",function(j){for(var l=[],r=j.length,s=e.data.user.id,o,X,V,G=0;G<r;G++){o=
j[G];V=o.type;X=V=="unicast"?o.to==s?o.from:o.to:o.to;o.id=X;V=="unicast"&&!o["new"]&&l.push({id:X,presence:"online"})}if(l.length){h.presence(l);h.complete()}g.handle(j)});e.bind("presence",function(j){h.presence(ia(j,c))})},handle:function(c){c.messages&&c.messages.length&&this.trigger("message",[c.messages]);c.presences&&c.presences.length&&this.trigger("presence",[c.presences]);c.statuses&&c.statuses.length&&this.trigger("status",[c.statuses])},sendMsg:function(c){c.ticket=this.data.connection.ticket;
x({type:"post",url:this.options.urls.message,cache:false,data:c})},sendStatus:function(c){c.ticket=this.data.connection.ticket;x({type:"post",url:this.options.urls.status,cache:false,data:c})},sendPresence:function(c){c.ticket=this.data.connection.ticket;this.data.user.show=c.show;this.status.set("s",c.show);x({type:"post",url:this.options.urls.presence,cache:false,data:c})},online:function(c){var e=this,g=e.status,h=[],j=[],l=g.get("tabs"),r=g.get("tabIds");r&&r.length&&l&&H(l,function(s){s[0]==
"b"&&h.push(s.slice(2));s[0]=="r"&&j.push(s.slice(2))});c=z({buddy_ids:h.join(","),room_ids:j.join(","),show:g.get("s")||"available"},c);e._ready(c);g.set("o",false);g.set("s",c.show);x({type:"post",dataType:"json",data:c,url:e.options.urls.online,success:function(s){if(!s||!s.user||!s.connection)e._stop("online error");else{s.user=z(e.data.user,s.user,{presence:"online"});e.data=s;e._go()}},error:function(){e._stop("online error")}})},offline:function(){var c=this.data;this.status.set("o",true);
this.connection.close();this._stop("offline");x({type:"post",url:this.options.urls.offline,type:"post",cache:false,data:{status:"offline",ticket:c.connection.ticket}})},_refresh:function(){var c=this.data;!c||!c.connection||!c.connection.ticket||x({type:"post",url:this.options.urls.refresh,type:"post",cache:false,data:{ticket:c.connection.ticket}})}});v.webim=J;z(J,{version:"1.0.1",defaults:{urls:{online:"webim/online",offline:"webim/offline",message:"webim/message",presence:"webim/presence",refresh:"webim/refresh",
status:"webim/status"}},log:aa,idsArray:pa,now:ga,isFunction:R,isArray:T,isObject:ha,trim:U,makeArray:E,extend:z,each:H,inArray:function(c,e){for(var g=0,h=e.length;g<h;g++)if(e[g]===c)return g;return-1},grep:function(c,e,g){for(var h=[],j=0,l=c.length;j<l;j++)!g!==!e(c[j],j)&&h.push(c[j]);return h},map:ia,JSON:N,ajax:x,comet:P,model:K,objectExtend:y});K("setting",{url:"/webim/setting",data:{blocked_rooms:[],play_sound:true,buddy_sticky:true,minimize_layout:true,msg_auto_pop:true}},{_init:function(){this.data=
z({},this.options.data,this.data)},get:function(c){return this.data[c]},set:function(c,e){var g=this,h=c;if(c){if(typeof c=="string"){h={};h[c]=e}var j=g.data,l=D(j,h);if(l){H(l,function(r,s){g.trigger("update",[r,s])});h=z({},j,h);g.data=h;x({type:"post",url:g.options.url,dataType:"json",cache:false,data:{data:N.encode(h)}})}}}});K("status",{key:"_webim"},{_init:function(){var c=this.data;if(c)this._save(c);else this.data=(c=ea(this.options.key))?N.decode(c):{}},set:function(c,e){var g=c;if(typeof c==
"string"){g={};g[c]=e}var h=this.data;D(h,g)&&this._save(z({},h,g))},get:function(c){return this.data[c]},clear:function(){this._save({})},_save:function(c){this.data=c;ea(this.options.key,N.encode(c),{path:"/",domain:u.domain})}});K("buddy",{url:"/webim/buddy"},{_init:function(){this.data=this.data||[];this.dataHash={};this.handle(this.data)},clear:function(){this.data=[];this.dataHash={}},count:function(c){var e=this.dataHash,g=0,h;for(var j in e)if(ha(c)){h=true;for(var l in c)if(c[l]!=e[j][l])h=
false;h&&g++}else g++;return g},get:function(c){return this.dataHash[c]},complete:function(){var c=this.dataHash,e=[],g;for(var h in c){g=c[h];g.incomplete&&g.presence=="online"&&e.push(h)}this.load(e)},update:function(c){this.load(c)},presence:function(c){var e=this.dataHash;c=T(c)?c:[c];for(var g in c){var h=c[g];h.presence=h.presence=="offline"?"offline":"online";h.incomplete=!e[h.id]}this.handle(c)},load:function(c){c=pa(c);c.length&&x({type:"get",url:this.options.url,cache:false,dataType:"json",
data:{ids:c.join(",")},context:this,success:this.handle})},handle:function(c){var e=this.data,g=this.dataHash,h={};c=c||[];var j,l;for(var r in c){j=c[r];if(id=j.id){if(!g[id]){j.presence=j.presence||"online";j.show=j.show?j.show:j.presence=="offline"?"unavailable":"available";g[id]={};e.push(g[id])}j.incomplete=!!j.incomplete;if(l=D(g[id],j)){j=l.presence||"update";h[j]=h[j]||[];z(g[id],l);h[j].push(g[id])}}}for(var s in h)this.trigger(s,[h[s]]);this.options.active&&this.complete()}});(function(){K("room",
{urls:{join:"/webim/join",leave:"/webim/leave",member:"/webim/members"}},{_init:function(){this.data=this.data||[];this.dataHash={}},get:function(c){return this.dataHash[c]},block:function(c){var e=this.dataHash[c];if(e&&!e.blocked){e.blocked=true;var g=[];H(this.dataHash,function(h,j){j.blocked&&g.push(j.id)});this.trigger("block",[c,g])}},unblock:function(c){var e=this.dataHash[c];if(e&&e.blocked){e.blocked=false;var g=[];H(this.dataHash,function(h,j){j.blocked&&g.push(j.id)});this.trigger("unblock",
[c,g])}},handle:function(c){var e=this,g=e.data,h=e.dataHash;H(c,function(j,l){var r=l.id;if(r){l.members=l.members||[];l.count=l.count||0;l.all_count=l.all_count||0;if(h[r])z(h[r],l);else{h[r]=l;g.push(l)}e.trigger("join",[h[r]])}})},addMember:function(c,e){var g=this;if(T(e))H(e,function(s,o){g.addMember(c,o)});else{var h=g.dataHash[c];if(h){for(var j=h.members,l,r=j.length;r--;)if(j[r].id==e.id)l=j[r];if(!l){e.nick=e.nick;j.push(e);h.count=j.length;g.trigger("addMember",[c,e])}}}},removeMember:function(c,
e){var g=this.dataHash[c];if(g){for(var h=g.members,j,l=h.length;l--;)if(h[l].id==e){j=h[l];h.splice(l,1);g.count--}j&&self.trigger("removeMember",[c,j])}},initMember:function(c){var e=this.dataHash[c];if(e&&!e.initMember){e.initMember=true;this.loadMember(c)}},loadMember:function(c){var e=this,g=e.options;x({type:"get",cache:false,url:g.urls.member,dataType:"json",data:{ticket:g.ticket,id:c},success:function(h){e.addMember(c,h)}})},join:function(c){var e=this,g=e.options;x({cache:false,type:"post",
url:g.urls.join,dataType:"json",data:{ticket:g.ticket,id:c,nick:g.user.nick},success:function(h){e.initMember(c);e.handle([h])}})},leave:function(c){var e=this.options,g=this.dataHash[c],h=e.user;if(g){g.initMember=false;x({cache:false,type:"post",url:e.urls.leave,data:{ticket:e.ticket,id:c,nick:h.nick}});this.trigger("leave",[g])}},clear:function(){}})})();K("history",{urls:{load:"webim/history",clear:"webim/clear_history"}},{_init:function(){this.data=this.data||{};this.data.unicast=this.data.unicast||
{};this.data.multicast=this.data.multicast||{}},unicast:function(c){return this.data.unicast[c]},multicast:function(c){return this.data.multicast[c]},handle:function(c){var e=this.data,g={unicast:{},multicast:{}};c=E(c);var h=c.length,j,l,r=this.options.userInfo.id;if(h){for(var s=0;s<h;s++){j=c[s];o=j.type;if((l=o=="unicast"?j.to==r?j.from:j.to:j.to)&&o){g[o][l]=g[o][l]||[];g[o][l].push(j)}}for(var o in g)for(l in g[o]){j=g[o][l];if(e[o][l]){e[o][l]=e[o][l].concat(j);this._triggerMsg(o,l,j)}else this.load(o,
l)}}},_triggerMsg:function(c,e,g){this.trigger(c,[e,g])},clear:function(c,e){var g=this.options;this.data[c][e]=[];this.trigger("clear",[c,e]);x({url:g.urls.clear,type:"post",cache:false,data:{type:c,id:e}})},init:function(c,e,g){if(T(g)){this.data[c][e]=g;this._triggerMsg(c,e,g)}},load:function(c,e){var g=this,h=g.options;g.data[c][e]=[];x({url:h.urls.load,cache:false,type:"get",dataType:"json",data:{type:c,id:e},success:function(j){g.init(c,e,j)}})}})})(window,document);
(function(v,u,W){function ga(){return false}function R(a){var b="";if(a.length==0)return"";b=a.replace(/&/g,"&gt;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/    /g,"&nbsp;");b=b.replace(/\'/g,"&#39;");b=b.replace(/\"/g,"&quot;");return b=b.replace(/\n/g,"<br />")}function T(a){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"])*$/.test(a)}function ha(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType==1&&a!=b&&d.push(a);return d}function U(a,b){return a&&
RegExp("(^|\\s+)"+b+"(\\s+|$)").test(a.className)}function D(a,b){if(a)U(a,b)||(a.className+=" "+b)}function E(a,b){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," "))}function z(a,b,d){a&&(a.className=a.className.replace(RegExp("(^|\\s+)("+b.split(/\s+/).join("|")+")(?=(\\s+|$))","g")," ")+" "+d)}function H(a,b,d){t(a,"mouseover",function(){D(this,b);d&&E(this,d)});t(a,"mouseout",function(){E(this,b);d&&D(this,d)})}function ia(a,b,d){if(typeof d===
"boolean")d?D(a,b):E(a,b);else U(a,b)?E(a,b):D(a,b)}function L(a){a&&a.style&&(a.style.display="block")}function x(a){a&&a.style&&(a.style.display="none")}function ka(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function t(a,b,d){if(a.addEventListener)a.addEventListener(b,d,false);else{a["e"+b+d]=d;a[b+d]=function(){return a["e"+b+d](v.event)};a.attachEvent("on"+b,a[b+d])}}function P(a){if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}}function ea(a){if(!a.target)a.target=a.srcElement||
u;if(a.target.nodeType===3)a.target=a.target.parentNode;return a.target}function aa(a){a.setAttribute("unselectable","on");a.style.MozUserSelect="none";t(a,"selectstart",ga)}function J(){if(!o){o=true;if(X){for(var a,b=0;a=X[b++];)a();X=null}}}function pa(){if(!V){V=true;if(u.readyState==="complete")return J();if(u.addEventListener)u.addEventListener("DOMContentLoaded",function(){u.removeEventListener("DOMContentLoaded",arguments.callee,false);J()},false);else if(u.attachEvent){u.attachEvent("onreadystatechange",
function(){if(u.readyState==="complete"){u.detachEvent("onreadystatechange",arguments.callee);J()}});u.documentElement.doScroll&&v==v.top&&function(){if(!o){try{u.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}J()}}()}t(v,"load",J)}}function K(a){var b=new Date;b.setTime(a?parseFloat(a)+K.timeSkew:(new Date).getTime());this.date=b}function w(a,b,d){d=h({locale:w.locale},d);d=w.dictionary[d.locale];c(d)||(d={});a=d[a]===W?a:d[a];if(b){ba=b;for(var f in b)a=a.replace(/\{\{(.*?)\}\}/g,
A)}return a}function y(a,b){this.element=a;this.options=h({},y.defaults,b);this._init()}function la(a){a=a.getElementsByTagName("*");for(var b,d,f={},i=a.length-1;i>-1;i--){b=a[i];if((d=b.id)&&d.indexOf(":")==0)f[d.substring(1,d.length)]=b}return f}function F(a){var b=u.createElement("div");b.innerHTML=a;return b=b.firstChild}function S(a,b,d){function f(i,k){this.id=na++;this.name=a;this.className="webim-"+a;this.options=h({},f.defaults,k);if(this.element=i||this.template&&F(this.template())||this.options.template&&
F(I(this.options.template))){this.options.className&&D(this.element,this.options.className);this.$=la(this.element)}N(this._init)&&this._init();N(this._initEvents)&&this._initEvents()}f.defaults=b;h(f.prototype,r,S.prototype,d);y[a]=f}function ma(a,b){y.apps[a]=b||{}}function Z(a,b){return b?a=="b"||a=="buddy"||a=="unicast"?"b_"+b:"r_"+b:a}function $(){u.selection&&(this.caretPos=u.selection.createRange())}var ja=webim.idsArray,N=webim.isFunction,fa=webim.isArray,c=webim.isObject,e=webim.trim,g=webim.makeArray,
h=webim.extend,j=webim.each,l=webim.grep,r=webim.objectExtend,s=webim.map,o=false,X=[],V=false;K.timeSkew=0;K.init=function(a){K.timeSkew=(new Date).getTime()-parseFloat(a)};h(K.prototype,{getTime:function(){var a=this.date,b=a.getHours();a=a.getMinutes();if(a<10)a="0"+a;return b+":"+a+""},getDay:function(a){var b=this.date;if(a){a=new Date;a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);a=a.getTime()-b.getTime();if(a<=0)return w("dt:today");else if(a<864E5)return w("dt:yesterday")}return w("dt:monthdate",
{month:w(["dt:january","dt:february","dt:march","dt:april","dt:may","dt:june","dt:july","dt:august","dt:september","dt:october","dt:november","dt:december"][b.getMonth()]),date:b.getDate()})}});var G=function(){var a=true,b={lib:"sound.swf",msg:"sound/msg.mp3"};return{enable:function(){a=true},disable:function(){a=false},init:function(d){h(b,d);d=b.lib+"?_"+(new Date).getTime();d=navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length?'<embed type="application/x-shockwave-flash" width="10" height="10" id="webim-flashlib" allowscriptaccess="always" src="'+
d+'" />':'<object width="10" height="10" id="webim-flashlib" type="application/x-shockwave-flash" data="'+d+'">\t\t\t\t<param name="allowScriptAccess" value="always" />\t\t\t\t<param name="movie" value="'+d+'" />\t\t\t\t<param name="scale" value="noscale" />\t\t\t\t</object>';try{u.getElementById("webim-flashlib-c").innerHTML=d}catch(f){}},play:function(d){d=T(d)?d:b[d];if(a)try{u.getElementById("webim-flashlib").playSound(d?d:"/sound/sound.mp3")}catch(f){}}}}(),qa=function(){var a=false;t(v,"focus",
function(){a=false});t(v,"blur",function(){a=true});var b=u.title,d=0,f=false;return function(i,k){if(a){if(m){clearInterval(m);d=0;f=false}var m=setInterval(function(){d++;f=!f;if(d==k||!a){clearInterval(m);d=0;f=false}u.title=f?"["+i+"]"+b:b},1500)}}}(),ba={},A=function(a,b){return ba[b]||""};w.locale="zh-CN";w.dictionary={};w.store=function(a,b){var d=w.dictionary;c(d[a])||(d[a]={});h(d[a],b)};h(y.prototype,r,{render:function(){var a=this,b=a.layout;a.element.appendChild(b.element);setTimeout(function(){a.initSound()},
1E3);b.buildUI()},_init:function(){var a=this.im=new webim,b=this.options;b=this.layout=new y.layout(null,h({chatAutoPop:a.setting.get("msg_auto_pop")},b.layoutOptions));a.setting.get("play_sound")?G.enable():G.disable();a.setting.get("minimize_layout")?b.collapse():b.expand();this._initEvents()},addApp:function(a,b){var d=y.apps[a];if(d){var f=this,i=f.im;N(d.init)&&d.init.apply(f,[b]);N(d.ready)&&i.bind("ready",function(){d.ready.apply(f,arguments)});N(d.go)&&i.bind("go",function(){d.go.apply(f,
arguments)});N(d.stop)&&i.bind("stop",function(){d.stop.apply(f,arguments)})}},initSound:function(a){G.init(a||this.options.soundUrls)},_initEvents:function(){var a=this,b=a.im,d=b.buddy,f=b.history,i=b.setting,k=a.layout,m=b.room;b.bind("ready",function(){k.changeState("ready")}).bind("go",function(n){k.changeState("active");k.option("user",n.user);K.init(n.server_time);a._initStatus()}).bind("stop",function(n){n=="offline"&&k.removeAllChat();k.updateAllChat();k.changeState("stop")});i.bind("update",
function(n,q){switch(n){case "play_sound":q?G.enable():G.disable();break;case "msg_auto_pop":k.option("chatAutoPop",q);break;case "minimize_layout":q?k.collapse():k.expand();break}});d.bind("online",function(n){k.updateChat("buddy",n)}).bind("offline",function(n){k.updateChat("buddy",n)}).bind("update",function(n){k.updateChat("buddy",n)});m.bind("addMember",function(n,q){var p=k.chat("room",n);p&&p.addMember(q.id,q.nick,q.id==b.data.user.id)}).bind("removeMember",function(n,q){var p=k.chat("room",
n);p&&p.removeMember(q.id,q.nick)});k.bind("collapse",function(){i.set("minimize_layout",true)});k.bind("expand",function(){i.set("minimize_layout",false)});k.bind("displayUpdate",function(){a._updateStatus()});b.bind("message",function(n){for(var q=false,p=n.length,B,Y=b.data.user.id,O,Q,C=0;C<p;C++){B=n[C];O=B.id;type=B.type;(Q=k.chat(type,O))&&Q.status("");if(!Q){B.type==="unicast"?a.addChat(type,O,null,null,B.nick):a.addChat(type,O);Q=k.chat(type,O)}Q&&i.get("msg_auto_pop")&&!k.activeTabId&&k.focusChat(O);
Q.window.notifyUser("information","+1");O=Q.window.pos;O==-1&&k.setNextMsgNum("+1");O==1&&k.setPrevMsgNum("+1");if(B.from!=Y)q=true}if(q){G.play("msg");qa(w("new message"),5)}});b.bind("status",function(n){j(n,function(q,p){var B=b.data.user.id,Y=p.from;if(!(B!=p.to&&B!=p.from))(B=k.chat("buddy",Y))&&B.status(p.show)})});f.bind("unicast",function(n,q){var p=k.chat("unicast",n);p&&p.history.add(q)});f.bind("multicast",function(n,q){var p=k.chat("multicast",n);p&&p.history.add(q)});f.bind("clear",function(n,
q){var p=k.chat(n,q);p&&p.history.clear()})},__status:false,_initStatus:function(){var a=this,b=a.layout;if(a.__status)return b.updateAllChat();a.__status=true;var d=a.im.status,f=d.get("tabs"),i=d.get("tabIds"),k=d.get("p");d=d.get("a");i&&i.length&&f&&j(f,function(m,n){var q=m.slice(2),p=m.slice(0,1);a.addChat(p,q,{},{isMinimize:true});b.chat(m).window.notifyUser("information",n.n)});k&&(b.prevCount=k)&&b._fitUI();d&&b.focusChat(d)},addChat:function(a,b,d,f,i){a=a=="b"||a=="buddy"||a=="unicast"?
"buddy":"room";var k=this,m=k.layout,n=k.im,q=k.im.history,p=n.buddy,B=n.room;if(!m.chat(a,b))if(a=="room"){var Y=q.multicast(b),O=B.get(b);i=O||{id:b,nick:i||b};i.presence="online";m.addChat(a,i,h({history:Y,block:true,emot:true,clearHistory:false,member:true,msgType:"multicast"},d),f);Y||q.load("multicast",b);var Q=m.chat(a,b);Q.bind("sendMsg",function(C){n.sendMsg(C);q.handle(C)}).bind("select",function(C){p.online(C.id);k.addChat("buddy",C.id,null,null,C.nick);m.focusChat("buddy",C.id)}).bind("block",
function(C){B.block(C.id)}).bind("unblock",function(C){B.unblock(C.id)}).window.bind("close",function(){Q.options.info.blocked&&B.leave(b)});setTimeout(function(){Q.options.info.blocked?B.join(b):B.initMember(b)},500);fa(i.members)&&j(i.members,function(C,ra){Q.addMember(ra.id,ra.nick,ra.id==n.data.user.id)})}else{Y=q.unicast(b);i=(O=p.get(b))||{id:b,nick:i||b};m.addChat(a,i,h({history:Y,block:false,emot:true,clearHistory:true,member:false,msgType:"unicast"},d),f);O||p.update(b);Y||q.load("unicast",
b);m.chat(a,b).bind("sendMsg",function(C){n.sendMsg(C);q.handle(C)}).bind("sendStatus",function(C){n.sendStatus(C)}).bind("clearHistory",function(C){q.clear("unicast",C.id)})}},_updateStatus:function(){var a=this.layout,b={};j(a.tabs,function(d,f){b[d]={n:f._count()}});this.im.status.set({tabs:b,tabIds:a.tabIds,p:a.prevCount,a:a.activeTabId})}});var ca=function(a,b){if(b===W)return parseInt(a.innerHTML);else if(b){b=typeof b=="number"?b:parseInt(a.innerHTML)+parseInt(b);a.innerHTML=b.toString();L(a)}else{a.innerHTML=
"0";x(a)}return b},I=function(){function a(f,i){return b&&b[i]!=W?b[i]:w(i)}var b=null,d=/\<\%\=(.*?)\%\>/ig;return function(f,i){if(!f)return"";b=i;return f.replace(d,a)}}(),M={add:function(a,b,d){a=y[a].prototype;for(var f in d){a.plugins[f]=a.plugins[f]||[];a.plugins[f].push([b,d[f]])}},call:function(a,b,d){if((b=a.plugins[b])&&a.element.parentNode)for(var f=0;f<b.length;f++)a.options[b[f][0]]&&b[f][1].apply(a.element,d)}},na=1;h(S.prototype,{_init:function(){}});h(y,{version:"3.0.1",widget:S,
app:ma,plugin:M,i18n:w,date:K,ready:function(a){pa();o?a():X.push(a)},createElement:F,defaults:{},apps:{}});webim.ui=y;S("window",{isMinimize:false,minimizable:true,maximizable:false,closeable:true,sticky:true,titleVisibleLength:12,count:0,template:'<div id=":webim-window" class="webim-window ui-widget">                                            <div class="webim-window-tab-wrap">                                            <div id=":tab" class="webim-window-tab ui-state-default">                                            <div class="webim-window-tab-inner">                                                    <div id=":tabTip" class="webim-window-tab-tip">                                                            <strong id=":tabTipC"><%=tooltip%></strong>                                                    </div>                                                    <a id=":tabClose" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                    <div id=":tabCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em id=":tabIcon" class="webim-icon webim-icon-comments"></em>                                                    <h4 id=":tabTitle"><%=title%></h4>                                            </div>                                            </div>                                            </div>                                            <div><div id=":window" class="webim-window-window">\t\t\t\t\t\t<iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe>                                                    <div id=":header" class="webim-window-header ui-widget-header ui-corner-top">                                                            <span id=":actions" class="webim-window-actions">                                                                    <a id=":minimize" title="<%=minimize%>" class="webim-window-minimize" href="#minimize"><em class="ui-icon ui-icon-minus"><%=minimize%></em></a>                                                                    <a id=":maximize" title="<%=maximize%>" class="webim-window-maximize" href="#maximize"><em class="ui-icon ui-icon-plus"><%=maximize%></em></a>                                                                    <a id=":close" title="<%=close%>" class="webim-window-close" href="#close"><em class="ui-icon ui-icon-close"><%=close%></em></a>                                                            </span>                                                            <h4 id=":headerTitle"><%=title%></h4>                                                            <div id=":subHeader" class="webim-window-subheader"></div>                                                    </div>                                                    <div id=":content" class="webim-window-content ui-widget-content">                                                    </div>                                            </div>                                            </div>                                            </div>'},
{html:function(a){return this.$.content.appendChild(a)},subHeader:function(a){this.$.subHeader.innerHTML="";return this.$.subHeader.appendChild(a)},_init:function(a,b){b=this.options;var d=this.$;a=this.element;a.window=this;b.tabWidth&&(d.tab.style.width=b.tabWidth+"px");b.subHeader&&this.subHeader(b.subHeader);this.title(b.title,b.icon);!b.minimizable&&x(d.minimize);!b.maximizable&&x(d.maximize);if(!b.closeable){x(d.tabClose);x(d.close)}b.isMinimize?this.minimize():this.restore();b.onlyIcon?x(d.tabTitle):
ka(d.tabTip);b.count&&this.notifyUser("information",b.count);da(this)},notifyUser:function(a,b){var d=this.$;if(a=="information")if(this.isMinimize())if(ca(d.tabCount,b)){D(d.tab,"ui-state-highlight");E(d.tab,"ui-state-default")}},_count:function(){return ca(this.$.tabCount)},title:function(a,b){var d=this.$,f=d.tabIcon;if(b)if(T(b)){f.className="webim-icon";f.style.backgroundImage="url("+b+")"}else f.className="webim-icon webim-icon-"+b;d.tabTipC.innerHTML=a;f=this.options.titleVisibleLength;if(a){for(var i=
0,k=[],m=a.split(""),n=m.length,q=0;q<n;q++)if(i>=f||i<0)break;else{if(m[q].charCodeAt(0)>255)i+=2;else i++;k.push(m[q])}f=k.join("")}else f=a;(d.tabTitle.innerHTML=f)&&a&&f.length<a.length&&d.tabTitle.setAttribute("title",a);d.headerTitle.innerHTML=a},_changeState:function(a){z(this.element,"webim-window-normal webim-window-maximize webim-window-minimize","webim-window-"+(a=="restore"?"normal":a));this.trigger("displayStateChange",[a])},active:function(){return U(this.element,"webim-window-active")},
activate:function(){if(!this.active()){D(this.element,"webim-window-active");this.trigger("activate")}},deactivate:function(){if(this.active()){E(this.element,"webim-window-active");this.options.sticky||this.minimize();this.trigger("deactivate")}},_setVisibile:function(){var a=this.$;z(a.tab,"ui-state-default ui-state-highlight","ui-state-active");this.activate();ca(a.tabCount,0)},maximize:function(){if(!this.isMaximize()){this._setVisibile();this._changeState("maximize")}},restore:function(){if(!U(this.element,
"webim-window-normal")){this._setVisibile();this._changeState("restore")}},minimize:function(){if(!this.isMinimize()){z(this.$.tab,"ui-state-active","ui-state-default");this.deactivate();this._changeState("minimize")}},tabClose:function(){this.close()},close:function(){this.trigger("close");ka(this.element)},_initEvents:function(){var a=this,b=a.$,d=b.tab,f=function(i){if(i){i.stopPropagation&&i.stopPropagation();i.cancelBubble=true}P(i)};t(d,"click",function(i){a.isMinimize()?a.restore():a.minimize();
f(i)});t(d,"mouseover",function(){D(this,"ui-state-hover");E(this,"ui-state-default")});t(d,"mouseout",function(){E(this,"ui-state-hover");this.className.indexOf("ui-state-")==-1&&D(this,"ui-state-default")});t(d,"mousedown",f);aa(d);j(ha(b.actions.firstChild),function(i,k){H(k,"ui-state-hover")});j(["minimize","maximize","close","tabClose"],function(i,k){t(b[k],"click",function(m){this.disabled||a[k]();f(m)});t(b[k],"mousedown",f)})},height:function(){return this.$.content.offsetHeight},_fitUI:function(){},
isMaximize:function(){return U(this.element,"webim-window-maximize")},isMinimize:function(){return U(this.element,"webim-window-minimize")}});var da=function(){var a=false,b=function(){a&&a.deactivate();a=false;return true},d=function(){this&&this!=a&&b()&&(a=this)},f=function(){this&&a==this&&(a=false)};t(u,"mousedown",function(i){i=ea(i);for(var k;i;)if(i.id==":webim-window"){k=i;break}else i=i.parentNode;if(k)(i=k.window)&&i.activate();else b()});return function(i){if(i.active()){b();a=i}i.bind("activate",
d);i.bind("deactivate",f)}}();S("layout",{template:'<div id="webim" class="webim webim-state-ready">                    <div class="webim-preload ui-helper-hidden-accessible">                    <div id="webim-flashlib-c">                    </div>                    </div><div id=":layout" class="webim-layout"><iframe class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><div class="webim-layout-bg ui-state-default ui-toolbar"></div><div class="webim-ui ui-helper-clearfix">                            <div id=":shortcut" class="webim-shortcut">                            </div>                            <div class="webim-layout-r">                            <div id=":panels" class="webim-panels">                                <div class="webim-window-tab-wrap ui-widget webim-panels-next-wrap">                                            <div id=":next" class="webim-window-tab webim-panels-next ui-state-default">                                                    <div id=":nextMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <em class="ui-icon ui-icon-triangle-1-w"></em>                                                    <span id=":nextCount">0</span>                                            </div>                                </div>                                <div id=":tabsWrap" class="webim-panels-tab-wrap">                                        <div id=":tabs" class="webim-panels-tab">                                        </div>                                </div>                                <div class="webim-window-tab-wrap ui-widget webim-panels-prev-wrap">                                            <div id=":prev" class="webim-window-tab webim-panels-prev ui-state-default">                                                    <div id=":prevMsgCount" class="webim-window-tab-count">                                                            0                                                    </div>                                                    <span id=":prevCount">0</span>                                                    <em class="ui-icon ui-icon-triangle-1-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-collapse-wrap ui-widget">                                            <div id=":collapse" class="webim-window-tab webim-collapse ui-state-default" title="<%=collapse%>">                                                    <em class="ui-icon ui-icon-circle-arrow-e"></em>                                            </div>                                </div>                                <div class="webim-window-tab-wrap webim-expand-wrap ui-widget">                                            <div id=":expand" class="webim-window-tab webim-expand ui-state-default" title="<%=expand%>">                                                    <em class="ui-icon ui-icon-circle-arrow-w"></em>                                            </div>                                </div>                            </div>                            <div id=":widgets" class="webim-widgets">                            </div>                            </div>            </div></div>                    </div>',
shortcutLength:5,chatAutoPop:true,tpl_shortcut:'<div class="webim-window-tab-wrap ui-widget webim-shortcut-item"><a class="webim-window-tab" href="<%=link%>" target="<%=target%>">                                                    <div class="webim-window-tab-tip">                                                            <strong><%=title%></strong>                                                    </div>                                                    <em class="webim-icon" style="background-image:url(<%=icon%>)"></em>                                            </a>                                            </div>'},
{_init:function(a,b){b=this.options;h(this,{window:v,widgets:{},panels:{},tabWidth:136,maxVisibleTabs:null,animationTime:210,activeTabId:null,tabs:{},tabIds:[],nextCount:0,prevCount:0});b.unscalable&&D(this.$.layout,"webim-layout-unscalable");b.isMinimize&&this.collapse()},changeState:function(a){this.element.className="webim webim-state-"+a},_ready:false,buildUI:function(){var a=this.$;this.maxVisibleTabs=parseInt(((u.compatMode==="CSS1Compat"&&u.documentElement.clientWidth||u.body.clientWidth)-
45-a.shortcut.offsetWidth-a.widgets.offsetWidth-70)/this.tabWidth);this._fitUI();this._ready=true},_updatePrevCount:function(a){var b=this.tabIds,d=this.maxVisibleTabs,f=b.length,i=this.prevCount;if(!(f<=d)){if(a){for(var k=0,m=0;m<f;m++)if(b[m]==a){k=m;break}if(k<=i)i=k;else if(k>=i+d)i=k-d+1}else i=f-d;this.prevCount=i}},_setVisibleTabs:function(a){for(var b=this.prevCount,d=b+this.maxVisibleTabs,f=this.tabs,i=this.tabIds,k=i.length,m=0,n=0,q=0;q<k;q++){var p=f[i[q]];if(q<b||q>=d)if(a)L(p.element);
else{this.activeTabId==i[q]&&p.minimize();var B=p._count();if(q<b){n+=B;p.pos=1}else{m+=B;p.pos=-1}x(p.element)}else{p.pos=0;L(p.element)}}if(!a){this.setNextMsgNum(m);this.setPrevMsgNum(n)}},setNextMsgNum:function(a){ca(this.$.nextMsgCount,a)},setPrevMsgNum:function(a){ca(this.$.prevMsgCount,a)},slideing:false,_slide:function(a){var b=this,d=b.prevCount,f=b.nextCount;if(f>0&&a==-1||d>0&&a==1){b.slideing=true;if(f==1&&a==-1||d==1&&a==1)b.slideing=false;b._slideSetup(false);b._setVisibleTabs(true);
if(a==-1){b.nextCount--;b.prevCount++}else if(a==1){b.nextCount++;b.prevCount--}var i=b.$.tabs,k=parseFloat(i.style.left);d=-1*b.tabWidth*b.nextCount;var m=parseInt(500/13),n=1,q=(d-k)/m,p=setInterval(function(){i.style.left=k+q*n+"px";if(n==m){if(b.slideing)b._slide(a);else{b._fitUI();b._slideReset()}clearInterval(p)}else n++},13)}},_slideUp:function(){this.slideing=false},_slideSetup:function(a){var b=this.$,d=b.tabsWrap;b=b.tabs;if(!this._tabsWidth)this._tabsWidth=b.clientWidth;if(a)this._tabsWidth=
null;d.style.position=a?"":"relative";d.style.overflow=a?"visible":"hidden";d.style.width=a?"":this._tabsWidth+"px";b.style.width=a?"":this.tabWidth*this.tabIds.length+"px";b.style.position=a?"":"relative"},_slideReset:function(){this._slideSetup(true)},_updateCount:function(){var a=this.maxVisibleTabs,b=this.tabIds.length,d=this.prevCount,f=this.nextCount;if(b<=a)d=f=0;else{f=b-a-d;f=f<0?0:f;d=b-a-f}this.prevCount=d;this.nextCount=f},_updateCountUI:function(){var a=this.$,b=this.prevCount,d=this.nextCount;
d<=0?D(a.next,"ui-state-disabled"):E(a.next,"ui-state-disabled");b<=0?D(a.prev,"ui-state-disabled"):E(a.prev,"ui-state-disabled");if(b>0||d>0){a.next.style.display="block";a.prev.style.display="block"}else{x(a.next);x(a.prev)}a.nextCount.innerHTML=d.toString();a.prevCount.innerHTML=b.toString()},_initEvents:function(){var a=this,b=a.$,d=false;t(a.window,"resize",function(){if(d){d=true;a.buildUI()}});t(b.next,"mousedown",function(){a._slide(-1)});t(b.next,"mouseup",function(){a._slideUp()});aa(b.next);
t(b.prev,"mousedown",function(){a._slide(1)});t(b.prev,"mouseup",function(){a._slideUp()});aa(b.prev);t(b.expand,"click",function(){if(!a.isMinimize())return false;a.expand();a.trigger("expand");return false});t(b.collapse,"click",function(){if(a.isMinimize())return false;a.collapse();a.trigger("collapse");return false});H(b.collapse,"ui-state-hover","ui-state-default");H(b.expand,"ui-state-hover","ui-state-default")},isMinimize:function(){return U(this.$.layout,"webim-layout-minimize")},collapse:function(){this.isMinimize()||
D(this.$.layout,"webim-layout-minimize")},expand:function(){this.isMinimize()&&E(this.$.layout,"webim-layout-minimize")},_displayUpdate:function(){this._ready&&this.trigger("displayUpdate")},_fitUI:function(){this._updateCount();this.$.tabs.style.left=-1*this.tabWidth*this.nextCount+"px";this._updateCountUI();this._setVisibleTabs();this._displayUpdate()},_stickyWin:null,_widgetStateChange:function(a,b){b!="minimize"&&j(this.widgets,function(d,f){f.window!=a&&f.window.minimize()});this._displayUpdate()},
widget:function(a){return this.widgets[a]},addWidget:function(a,b,d,f){var i=this;b=h(b,{closeable:false,subHeader:a.header});var k=a.element;b=new y.window(null,b);b.html(k);i.$[f?f:"widgets"].insertBefore(b.element,d&&i.widgets[d]?i.widgets[d].window.element:null);a.window=b;b.bind("displayStateChange",function(m){i._widgetStateChange(this,m)});i.widgets[a.name]=a},focusChat:function(a,b){b=Z(a,b);var d=this.tabs[b],f=this.panels[b];d&&d.isMinimize()&&d.restore();f&&f.focus()},chat:function(a,b){return this.panels[Z(a,
b)]},updateChat:function(a,b){b=g(b);for(var d,f=b.length,i,k=0;k<f;k++){d=b[k];(i=this.panels[Z(a,d.id)])&&i.update(d)}},updateAllChat:function(){j(this.panels,function(a,b){b.update()})},_onChatClose:function(a){this.tabIds=l(this.tabIds,function(b){return b!=a});delete this.tabs[a];delete this.panels[a];this._changeActive(a,true);this._fitUI()},_onChatChange:function(a,b){if(b=="minimize"){this._changeActive(a,true);this._displayUpdate()}else{this._changeActive(a);this._fitUI()}},_changeActive:function(a,
b){var d=this.activeTabId;if(b)d==a&&(this.activeTabId=null);else{d&&d!=a&&this.tabs[d].minimize();this.activeTabId=a;this._updatePrevCount(a)}},addChat:function(a,b,d,f){var i=this,k=i.panels,m=b.id;m=Z(a,m);if(!k[m]){a=i.tabs[m]=(new y.window(null,h({isMinimize:i.activeTabId||!i.options.chatAutoPop,tabWidth:i.tabWidth-2,titleVisibleLength:9},f))).bind("close",function(){i._onChatClose(m)}).bind("displayStateChange",function(n){i._onChatChange(m,n)});i.tabIds.push(m);i.$.tabs.insertBefore(a.element,
i.$.tabs.firstChild);k[m]=new y.chat(null,h({window:a,user:i.options.user,info:b},d));!a.isMinimize()&&i._changeActive(m);i._fitUI()}},removeChat:function(a,b){var d=this.tabs[Z(a,b)];d&&d.close()},removeAllChat:function(){j(this.tabs,function(a,b){b.close()})},addShortcut:function(a){var b=this;if(fa(a))j(a,function(i,k){b.addShortcut(k)});else if(c(a)){var d=b.$.shortcut,f=b.options.tpl_shortcut;if(!(d.childNodes.length>b.options.shortcutLength+1)){f=F(I(f,{title:w(a.title),icon:a.icon,link:a.link,
target:a.isExtlink?"_blank":""}));H(f.firstChild,"ui-state-hover");d.appendChild(f)}}},addWindow:function(){new y.window(null,{})},online:function(){},offline:function(){}});S("history",{user:{},info:{},template:'<div class="webim-history">                        <div id=":content" class="webim-history-content">                 </div></div>'},{_init:function(){M.call(this,"init",[null,this.ui()])},clear:function(){this.$.content.innerHTML="";this.trigger("clear")},add:function(a){a=g(a);var b=a.length,
d=[];if(b){for(var f=0;f<b;f++)d.push(this._renderMsg(a[f]));this.$.content.innerHTML+=d.join("");this.trigger("update")}},_renderMsg:function(a){a=h({},a);M.call(this,"render",[null,this.ui({msg:a})]);var b=a.from,d=a.to,f=a.timestamp,i=a.body,k=true,m=this._lastLogItem,n=[],q;q=a.nick;if(m&&m.to==d&&m.from==b&&f-m.timestamp<6E4)k=false;if(k){this._lastLogItem=a;a=new K(f);n.push('<h4><span class="webim-gray">');n.push(a.getDay(true));n.push(" ");n.push(a.getTime());n.push("</span>");n.push(q);n.push('</h4><hr class="webim-line ui-state-default" />')}n.push("<p>");
n.push(i);n.push("</p>");return n.join("")},_renderDateBreak:function(a){var b=this._lastLogItem,d=new Date,f=new Date,i=[];d.setTime(a);b&&f.setTime(b.timestamp);if(!b||d.getDate()!=f.getDate()||d.getMonth()!=f.getMonth()){i.push("<h5>");i.push((new K(a)).getDay(true));i.push("</h5>")}return i.join("")},ui:function(a){return h({element:this.element,$:this.$},a)},plugins:{}});var oa=function(){function a(f,i){return'<a href="'+(i=="www."?"http://"+f:f)+'"'+d+">"+f+"</a>"}function b(f,i){d+=" "+f+
'="'+i+'"'}var d;return function(f,i){d="";i&&c(i)&&j(i,b);return f.replace(/(https?:\/\/|www\.)([^\s<]+)/ig,a)}}();y.history.defaults.parseMsg=true;M.add("history","parseMsg",{render:function(a,b){var d=b.msg.body;d=R(d);d=oa(d,{target:"_blank"});b.msg.body=d}});y.history.defaults.emot=true;M.add("history","emot",{render:function(a,b){b.msg.body=y.emot.parse(b.msg.body)}});S("emot",{template:'<div class="webim-emot ui-widget-content"><%=emots%></div>'},{_init:function(){var a=this,b=a.element;j(b.firstChild.childNodes,
function(d,f){t(f,"click",function(){E(b,"webim-emot-show");a.trigger("select",this.firstChild.getAttribute("alt"))})})},template:function(){var a=this.emots=webim.ui.emot.emots,b=[];b.push('<ul class="ui-helper-clearfix">');j(a,function(d,f){var i=f.src,k=f.t?f.t:f.q[0];b.push('<li><img src="');b.push(i);b.push('" title="');b.push(k);b.push('" alt="');b.push(f.q[0]);b.push('" /></li>')});b.push("</ul>");return I(this.options.template,{emots:b.join("")})},toggle:function(){ia(this.element,"webim-emot-show")}});
h(y.emot,{emots:[{t:"smile",src:"smile.png",q:[":)"]},{t:"smile_big",src:"smile-big.png",q:[":d",":-d",":D",":-D"]},{t:"sad",src:"sad.png",q:[":(",":-("]},{t:"wink",src:"wink.png",q:[";)",";-)"]},{t:"tongue",src:"tongue.png",q:[":p",":-p",":P",":-P"]},{t:"shock",src:"shock.png",q:["=-O","=-o"]},{t:"kiss",src:"kiss.png",q:[":-*"]},{t:"glasses_cool",src:"glasses-cool.png",q:["8-)"]},{t:"embarrassed",src:"embarrassed.png",q:[":-["]},{t:"crying",src:"crying.png",q:[":'("]},{t:"thinking",src:"thinking.png",
q:[":-/",":-\\"]},{t:"angel",src:"angel.png",q:["O:-)","o:-)"]},{t:"shut_mouth",src:"shut-mouth.png",q:[":-X",":-x"]},{t:"moneymouth",src:"moneymouth.png",q:[":-$"]},{t:"foot_in_mouth",src:"foot-in-mouth.png",q:[":-!"]},{t:"shout",src:"shout.png",q:[">:o",">:O"]}],init:function(a){var b=webim.ui.emot,d=b._q={};a=h({dir:"webim/static/emot/default"},a);if(a.emots)b.emots=a.emots;var f=a.dir+"/";j(b.emots,function(i,k){if(k&&k.src)k.src=f+k.src;k&&k.q&&j(k.q,function(m,n){d[n]=i})})},parse:function(a){var b=
webim.ui.emot._q,d=webim.ui.emot.emots;b&&j(b,function(f,i){var k=d[i],m=k.src,n=k.t?k.t:k.q[0],q=[];q.push('<img src="');q.push(m);q.push('" title="');q.push(n);q.push('" alt="');q.push(k.q[0]);q.push('" />');f=R(f);f=f.replace(RegExp("(\\"+".$^*\\[]()|+?{}:<>".split("").join("|\\")+")","g"),"\\$1");a=a.replace(RegExp(f,"g"),q.join(""))});return a}});S("chat",{tpl_header:'<div><div id=":user" class="webim-user"> \t\t\t<a id=":userPic" class="webim-user-pic ui-corner-all ui-state-active" href="#id"><img width="50" height="50" src="" defaultsrc="" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" class="ui-corner-all"></a> \t\t\t<span id=":userStatus" title="" class="webim-user-status">&nbsp;</span> \t\t     </div></div>',
template:'<div class="webim-chat"> \t\t\t\t<div class="webim-chat-notice-wrap"><div id=":notice" class="webim-chat-notice ui-state-highlight"></div></div>                                                 <div id=":content" class="webim-chat-content">                                                                                                                 <div id=":status" class="webim-chat-status webim-gray"></div>                                                 </div>                                                 <div id=":actions" class="webim-chat-actions">                                                         <div id=":toolContent" class="webim-chat-tool-content"></div>                                                        <div id=":tools" class="webim-chat-tools ui-helper-clearfix ui-state-default"></div>                                                        <table class="webim-chat-t" cellSpacing="0">                                                                 <tr>                                                                         <td style="vertical-align:top;">                                                                         <em class="webim-icon webim-icon-chat-edit"></em>                                                                        </td>                                                                         <td style="vertical-align:top;width:100%;">                                                                         <div class="webim-chat-input-wrap">                                                                                <textarea id=":input" class="webim-chat-input webim-gray ui-widget-content"><%=input notice%></textarea>                                                                         </div>                                                                         </td>                                                                 </tr>                                                         </table>                                                 </div>                                         </div>'},
{_init:function(){var a=this.element,b=this.options,d=this.window=b.window,f=this.history=new y.history(null,{user:b.user,info:b.info});this.$.content.insertBefore(f.element,this.$.content.firstChild);this.header=F(I(b.tpl_header));h(this.$,la(this.header));if(d){d.subHeader(this.header);d.html(a);this._bindWindow()}this.update(b.info);f.add(b.history);M.call(this,"init",[null,this.ui()]);this._adjustContent()},update:function(a){if(a){this.option("info",a);this.history.option("info",a);this._updateInfo(a)}a=
this.options.info.presence=="online";if(this.options.user.presence=="online")a?this.notice(""):this.notice(w("buddy offline notice",{name:this.options.info.nick}));else this.notice(w("user offline notice"));M.call(this,"update",[null,this.ui()])},focus:function(){var a=this.$.input;v.setTimeout(function(){a.focus()},0)},_noticeTime:null,_noticeTxt:"",notice:function(a,b){var d=this,f=d.$.notice,i=d._noticeTime;i&&clearTimeout(i);if(a)if(b){f.innerHTML=a;L(f);setTimeout(function(){if(d._noticeTxt)f.innerHTML=
d._noticeTxt;else x(f,500)},b)}else{d._noticeTxt=a;f.innerHTML=a;L(f)}else{d._noticeTxt=null;x(f)}},_adjustContent:function(){var a=this.$.content;a.scrollTop=a.scrollHeight},_fitUI:function(){this._adjustContent()},_bindWindow:function(){var a=this;a.window.bind("displayStateChange",function(b){if(b!="minimize"){v.setTimeout(function(){a.$.input.focus()},0);a._adjustContent()}})},_inputAutoHeight:function(){var a=this.$.input,b=a[0].scrollTop;if(b>0){var d=a.height();d>32&&d<100&&a.height(d+b)}},
_sendMsg:function(a){var b=this.options,d=b.info;a={type:b.msgType,to:d.id,from:b.user.id,nick:b.user.nick,offline:d.presence!="online",timestamp:(new Date).getTime(),body:a};M.call(this,"send",[null,this.ui({msg:a})]);this.trigger("sendMsg",a)},_inputkeypress:function(a){if(a.keyCode==13)if(a.ctrlKey){this.insert("\n",true);return true}else{var b=ea(a),d=b.value;if(e(d)){this._sendMsg(d);b.value="";P(a)}}else this._typing()},_onFocusInput:function(a){var b=this;ea(a);(v.getSelection?v.getSelection().toString():
u.selection?u.selection.createRange().text:"")||v.setTimeout(function(){b.$.input.focus()},0)},_initEvents:function(){var a=this,b=a.$,d=w("input notice"),f=b.input;a.history.bind("update",function(){a._adjustContent()}).bind("clear",function(){a.notice(w("clear history notice"),3E3)});t(f,"keyup",function(){$.call(this)});t(f,"click",$);t(f,"select",$);t(f,"focus",function(){E(this,"webim-gray");if(this.value==d)this.value=""});t(f,"blur",function(){if(this.value==""){D(this,"webim-gray");this.value=
d}});t(f,"keypress",function(i){a._inputkeypress(i)});t(b.content,"click",function(i){a._onFocusInput(i)})},_updateInfo:function(a){var b=this.$;b.userPic.setAttribute("href",a.url);b.userPic.firstChild.setAttribute("defaultsrc",a.default_pic_url?a.default_pic_url:"");setTimeout(function(){if(a.pic_url||a.default_pic_url)b.userPic.firstChild.setAttribute("src",a.pic_url||a.default_pic_url)},100);b.userStatus.innerHTML=a.status||"&nbsp";this.window.title(a.nick,a.show)},insert:function(a,b){var d=
this.$.input;d.focus();if(b){a||(a="");if(d.setSelectionRange){var f=d.value,i=d.selectionStart,k=d.selectionEnd,m=f.substring(0,i);f=f.substring(k);k=a.length;d.value=m+a+f;d.setSelectionRange(i+k,i+k)}else if(u.selection)if(i=d.caretPos){i.text=a;i.collapse();i.select()}else d.value+=a;else d.value+=a}else d.value=a},_statusText:"",sendStatus:function(a){if(!(!a||a==this._statusText||this.options.info.presence=="offline")){this._statusText=a;this.trigger("sendStatus",{to:this.options.info.id,show:a})}},
_checkST:false,_typing:function(){var a=this;a.sendStatus("typing");a._checkST&&clearTimeout(a._checkST);a._checkST=v.setTimeout(function(){a.sendStatus("clear")},6E3)},_setST:null,status:function(a){a=a||"clear";var b=this.$.status,d=this.options.info.nick,f="";f=a=="clear"?"":d+w(a);b.innerHTML=f;this._adjustContent();this._setST&&clearTimeout(this._setST);if(f!="")this._setST=v.setTimeout(function(){b.innerHTML=""},1E4)},destroy:function(){this.window.close()},ui:function(a){return h({self:this,
$:this.$,history:this.history},a)},plugins:{}});y.chat.defaults.emot=true;M.add("chat","emot",{init:function(a,b){var d=b.self,f=new y.emot;f.bind("select",function(k){d.focus();d.insert(k,true)});var i=F(I('<a href="#chat-emot" title="<%=emot%>"><em class="webim-icon webim-icon-emot"></em></a>'));t(i,"click",function(k){P(k);f.toggle()});b.$.toolContent.appendChild(f.element);b.$.tools.appendChild(i)},send:function(){}});y.chat.defaults.clearHistory=true;M.add("chat","clearHistory",{init:function(a,
b){var d=b.self,f=F(I('<a href="#chat-clearHistory" title="<%=clear history%>"><em class="webim-icon webim-icon-clear"></em></a>'));t(f,"click",function(i){P(i);d.trigger("clearHistory",[d.options.info])});b.$.tools.appendChild(f)}});y.chat.defaults.block=true;M.add("chat","block",{init:function(a,b){var d=b.self,f=d.options.info.blocked,i=d.options.info.nick,k=F('<a href="#chat-block" style="display:'+(f?"none":"")+'" title="'+w("block group",{name:i})+'"><em class="webim-icon webim-icon-unblock"></em></a>'),
m=F('<a href="#chat-block" style="display:'+(f?"":"none")+'" title="'+w("unblock group",{name:i})+'"><em class="webim-icon webim-icon-block"></em></a>');t(k,"click",function(n){P(n);x(k);L(m);d.trigger("block",[d.options.info])});t(m,"click",function(n){P(n);x(m);L(k);d.trigger("unblock",[d.options.info])});b.$.tools.appendChild(k);b.$.tools.appendChild(m)}});y.chat.defaults.member=true;h(y.chat.prototype,{addMember:function(a,b,d){var f=this,i=f.memberLi;if(!i[a]){var k=F('<li><a class="'+(d?"ui-state-disabled":
"")+'" href="'+a+'">'+b+"</a></li>");t(k.firstChild,"click",function(m){P(m);d||f.trigger("select",[{id:a,nick:b}])});i[a]=k;f.$.member.appendChild(k);f.$.memberCount.innerHTML=parseInt(f.$.memberCount.innerHTML)+1}},removeMember:function(a){var b=this.memberLi[a];if(b){this.$.member.removeChild(b);delete this.memberLi[a];this.$.memberCount.innerHTML=parseInt(this.$.memberCount.innerHTML)-1}}});M.add("chat","member",{init:function(a,b){var d=b.$;b.self.memberLi={};var f=F(I('<div class="webim-member ui-widget-content ui-corner-left"><iframe id=":bgiframe" class="webim-bgiframe" frameborder="0" tabindex="-1" src="about:blank;" ></iframe><h4><%=room member%>(<span id=":memberCount">0</span>)</h4><ul id=":ul"></ul></div>')),
i=la(f);d.member=i.ul;d.memberCount=i.memberCount;d.content.parentNode.insertBefore(f,d.content)}});ma("buddy",{init:function(a){a=a||{};var b=this,d=b.im,f=d.buddy,i=b.layout,k=b.buddy=new y.buddy(null,h({title:w("buddy")},a));i.addWidget(k,h({title:w("buddy"),icon:"buddy",sticky:d.setting.get("buddy_sticky"),className:"webim-buddy-window",isMinimize:!d.status.get("b"),titleVisibleLength:19},a.windowOptions));if(!a.disable_user){b.addApp("user");k.window.subHeader(b.user.element)}d.setting.bind("update",
function(p,B){p=="buddy_sticky"&&k.window.option("sticky",B)});k.bind("select",function(p){b.addChat("buddy",p.id);b.layout.focusChat("buddy",p.id)}).bind("online",function(){d.online()});k.window.bind("displayStateChange",function(p){if(p!="minimize"){f.option("active",true);d.status.set("b",1);f.complete()}else{d.status.set("b",0);f.option("active",false)}});var m=function(p){return c(p)?p.id:p},n=function(p){return p.show!="invisible"&&p.presence=="online"},q=function(p){return p.show=="invisible"};
f.bind("online",function(p){k.add(l(p,n))});f.bind("offline",function(p){k.remove(s(p,m))});f.bind("update",function(p){k.add(l(p,n));k.update(l(p,n));k.remove(s(l(p,q),m))});k.offline()},ready:function(){this.buddy.online()},go:function(){this.buddy.titleCount()},stop:function(a){var b=this.buddy;b.offline();a&&b.notice(a)}});S("buddy",{template:'<div id="webim-buddy" class="webim-buddy">\t\t<div id=":search" class="webim-buddy-search ui-state-default ui-corner-all"><em class="ui-icon ui-icon-search"></em><input id=":searchInput" type="text" value="" /></div>\t\t\t<div class="webim-buddy-content">\t\t\t\t<div id=":empty" class="webim-buddy-empty"><%=empty buddy%></div>\t\t\t\t\t<ul id=":ul"></ul>\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>',
tpl_group:'<li><h4><%=title%>(<%=count%>)</h4><hr class="webim-line ui-state-default" /><ul></ul></li>',tpl_li:'<li title=""><a href="<%=url%>" rel="<%=id%>" class="ui-helper-clearfix"><em class="webim-icon webim-icon-<%=show%>" title="<%=human_show%>"><%=show%></em><img width="25" src="<%=pic_url%>" defaultsrc="<%=default_pic_url%>" onerror="var d=this.getAttribute(\'defaultsrc\');if(d && this.src!=d)this.src=d;" /><strong><%=nick%></strong><span><%=status%></span></a></li>'},{_init:function(){this.groups=
{};this.li={};this.li_group={};this.size=0},_initEvents:function(){var a=this,b=a.$,d=b.search,f=b.searchInput,i=w("search buddy");t(d.firstChild,"click",function(){f.focus()});f.value=i;t(f,"focus",function(){D(d,"ui-state-active");if(this.value==i)this.value=""});t(f,"blur",function(){E(d,"ui-state-active");if(this.value=="")this.value=i});t(f,"keyup",function(){var k=this.value;j(a.li,function(m,n){k&&(n.text||n.innerHTML.replace(/<[^>]*>/g,"")).indexOf(k)==-1?x(n):L(n)})})},titleCount:function(){var a=
this.size,b=this.window,d=this.$.empty;b&&b.title(this.options.title+"("+(a?a:"0")+")");a?x(d):L(d);a>8?this.scroll(true):this.scroll(false)},scroll:function(a){ia(this.element,"webim-buddy-scroll",a)},_time:null,_titleBuddyOnline:function(a){var b=this;a||(a="");b._time&&clearTimeout(b._time);b._time=setTimeout(function(){b.titleCount()},5E3)},_title:function(a){var b=this.window;b&&b.title(this.options.title+"["+w(a)+"]")},notice:function(a,b){switch(a){case "buddyOnline":this._titleBuddyOnline(b);
break;default:this._title(a)}},online:function(){var a=this.$;this.notice("connect");L(a.empty)},offline:function(){var a=this.$;this.notice("offline");L(a.empty);this.scroll(false);this.removeAll()},_updateInfo:function(a,b){a=a.firstChild;a.setAttribute("href",b.url);a=a.firstChild;var d=b.show?b.show:"available";a.className="webim-icon webim-icon-"+d;a.setAttribute("title",w(d));a=a.nextSibling;a.setAttribute("defaultsrc",b.default_pic_url?b.default_pic_url:"");if(b.pic_url||b.default_pic_url)a.setAttribute("src",
b.pic_url||b.default_pic_url);a=a.nextSibling;a.innerHTML=b.nick;a=a.nextSibling;a.innerHTML=b.status||"&nbsp;";return a},_addOne:function(a,b){var d=this,f=d.li,i=a.id,k=d.$.ul;if(!f[i]){d.size++;if(!a.default_pic_url)a.default_pic_url="";a.status=a.status||"&nbsp;";a.show=a.show||"available";a.human_show=w(a.show);a.pic_url=a.pic_url||"";f=f[i]=F(I(d.options.tpl_li,a));t(f.firstChild,"click",function(q){P(q);d.trigger("select",[a]);this.blur()});var m=d.groups,n=w(a.group||"friend");m=m[n];if(!m){m=
F(I(d.options.tpl_group));x(m);if(n==w("stranger"))b=true;b?k.appendChild(m):k.insertBefore(m,k.firstChild);m={name:n,el:m,count:0,title:m.firstChild,li:m.lastChild};d.groups[n]=m}m.count==0&&L(m.el);d.li_group[i]=m;m.li.appendChild(f);m.count++;m.title.innerHTML=n+"("+m.count+")"}},_updateOne:function(a){var b=this.li,d=a.id;b[d]&&this._updateInfo(b[d],a)},update:function(a){a=g(a);for(var b=0;b<a.length;b++)this._updateOne(a[b])},add:function(a,b){a=g(a);for(var d=0;d<a.length;d++)this._addOne(a[d],
b);this.titleCount()},removeAll:function(){var a=[],b=this.li;for(var d in b)a.push(d);this.remove(a);this.titleCount()},remove:function(a){var b,d,f=this.li,i,k=this.li_group;a=ja(a);for(var m=0;m<a.length;m++){b=a[m];if(d=f[b]){this.size--;if(i=k[b]){i.count--;i.count==0&&x(i.el);i.title.innerHTML=i.name+"("+i.count+")"}ka(d);delete f[b]}}this.titleCount()},select:function(a){(a=this.li[a])&&a.firstChild.click();return a},destroy:function(){}})})(window,document);
